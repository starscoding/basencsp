Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.inas","../../scripts/ftp/components");Ext.Loader.setPath("Ext.components",eastcom.baseURL+"/static/commonjs/components");Ext.require(["Ext.form.*","Ext.data.*","Ext.grid.*","Ext.tip.*","Ext.ux.RowExpander","Ext.components.BaseDataComboBox","Ext.components.BaseCommonPagingToolbar"]);eastcom.modules.inas=(function(){var l=null;var i=null;Ext.define("ftpResult",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"protocol",type:"string"},{name:"ip",type:"string"},{name:"port",type:"string"},{name:"username",type:"string"},{name:"password",type:"string"},{name:"filePath",type:"string"},{name:"desc",type:"string"}]});var j=Ext.create("Ext.inas.VendorComboBox",{id:"protocol_qry",name:"protocol",labelAlign:"right",labelWidth:80,width:380,fieldLabel:"协议"});var h=Ext.create("Ext.data.Store",{pageSize:eastcom.pageSize,model:"ftpResult",proxy:{type:"ajax",url:eastcom.baseURL+"/FtpServerController/qryFtpServerInfo",reader:{type:"json",root:"data.elements",totalProperty:"data.total"},actionMethod:{read:"POST"},timeout:180000},listeners:{}});sm=Ext.create("Ext.selection.CheckboxModel",{});var b=[{text:"ID",dataIndex:"id",hidden:true},{text:"服务器名称",dataIndex:"name",align:"center",labelWidth:50,width:166},{text:"协议",dataIndex:"protocol",align:"center",labelWidth:50,width:166},{text:"IP",dataIndex:"ip",align:"center",labelWidth:50,width:166},{text:"端口",dataIndex:"port",align:"center",labelWidth:50,width:166},{text:"用户名",dataIndex:"username",align:"center",labelWidth:50,width:166},{text:"密码",dataIndex:"password",align:"center",labelWidth:50,width:166},{text:"文件路径",dataIndex:"filePath",align:"center",labelWidth:50,width:166},{text:"描述",dataIndex:"desc",align:"center",labelWidth:50,width:166}];var g=Ext.create("Ext.Action",{iconCls:"icon-add",text:BUTTON_NEW,disabled:false,hidden:false,handler:function(o,n){if(Ext.getCmp("FtpWin")==null){var m=Ext.create("Ext.inas.FtpWin",{});m.show()}}});var a=Ext.create("Ext.Action",{iconCls:"icon-edit",text:BUTTON_EDIT,disabled:true,handler:function(p,o){var n=Ext.getCmp("gridPanel").getSelectionModel().getSelection();if(Ext.getCmp("FtpWin")==null){var m=Ext.create("Ext.inas.FtpWin",{});m.show(undefined,function(){m.loadRecord(n[0])})}}});var f=Ext.create("Ext.Action",{iconCls:"icon-remove",text:BUTTON_DELETE,disabled:true,handler:function(p,o){var n=Ext.getCmp("gridPanel");var m=n.getSelectionModel().getSelection();Ext.Msg.show({title:MSG_WARNING,msg:DEL_BTN_INFO,buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(r){if(r=="yes"){n.getEl().mask(DEL_DELETING);var s="'";for(var q=0;q<m.length;q++){s+=(m[q].get("id")+"','")}s=s.substring(0,s.length-2);Ext.Ajax.request({url:eastcom.baseURL+"/FtpServerController/deleteFtpServerInfo",method:"POST",params:{ids:s},success:function(u,v){var t=Ext.JSON.decode(u.responseText);if(t.success=="true"){Ext.Msg.show({title:MSG_SUCCESS,msg:t.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});h.remove(m)}else{Ext.Msg.show({title:MSG_FAILURE,msg:t.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}n.getEl().unmask()},failure:function(t,u){}})}}})}});var d=Ext.create("Ext.grid.Panel",{id:"gridPanel",store:h,selModel:sm,columns:b,autoShow:true,viewConfig:{loadMask:true},bbar:Ext.create("Ext.components.BaseCommonPagingToolbar",{store:h,listeners:{change:function(n,m){i=m}}}),tbar:Ext.create("Ext.toolbar.Toolbar",{items:[g,"-",a,"-",f]}),listeners:{itemcontextmenu:function(m,q,o,n,p){p.stopEvent();contextMenu.showAt(p.getXY());return false},selectionchange:function(o,n,m){if(n.length>0){if(n.length==1){a.enable();f.enable()}else{a.disable();f.enable()}}else{a.disable();f.disable()}},afterrender:function(){Ext.tip.QuickTipManager.register({target:"userSearchInput",title:LABEL_TIPS+"：",text:USER_SEARCH_TIPS,width:100,dismissDelay:50000})}},animCollapse:false,viewConfig:{forceFit:false,sortAscText:"正序",sortDescText:"降序",getRowClass:function(m,q,p,o){var n;if(m.data.pbxName==""){n="my_row_Red"}return n}},renderTo:Ext.getBody()});function c(){if(Ext.getCmp("ftpForm").getForm().isValid()){var m=h.proxy;var n={serverName:Ext.getCmp("serverName_qry").getValue(),protocol:Ext.getCmp("protocol_qry").getValue(),port:Ext.getCmp("port_qry").getValue(),ip:Ext.getCmp("ip_qry").getValue(),username:Ext.getCmp("userName_qry").getValue(),password:Ext.getCmp("password_qry").getValue(),filePath:Ext.getCmp("filePath_qry").getValue(),desc:Ext.getCmp("desc_qry").getValue()};m.extraParams=n;h.loadPage(1,{start:0,limit:eastcom.pageSize,callback:function(){currentParam=n}})}}function e(){Ext.getCmp("ftpForm").getForm().reset()}function k(){Ext.create("Ext.Viewport",{layout:{type:"border",padding:5},listeners:{},items:[{region:"center",layout:"fit",frame:false,border:false,items:[d]},{region:"north",padding:"0 0 5 0",bodyPadding:10,items:[Ext.create("Ext.form.Panel",{border:false,id:"ftpForm",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{labelAlign:"right",labelWidth:80,width:380},items:[{xtype:"textfield",fieldLabel:"服务器名称",id:"serverName_qry"},j,{xtype:"button",style:"margin-left:20px",iconCls:"icon-search",width:60,text:BUTTON_SEARCH,handler:c},{xtype:"button",style:"margin-left:20px",formBind:false,width:70,text:BUTTON_RESET,handler:e}]},{xtype:"fieldset",checkboxToggle:true,collapsed:true,title:"更多条件",layout:"column",autoScroll:true,defaults:{layout:"anchor",border:false,defaults:{labelWidth:80,width:250,anchor:"95%",labelAlign:"right"}},items:[{columnWidth:1/3,defaultType:"textfield",items:[{xtype:"textfield",fieldLabel:"端口",id:"port_qry"},{xtype:"textfield",fieldLabel:"IP",id:"ip_qry"}]},{columnWidth:1/3,defaultType:"textfield",items:[{xtype:"textfield",fieldLabel:"用户名",id:"userName_qry"},{xtype:"textfield",fieldLabel:"密码",id:"password_qry"}]},{columnWidth:1/3,defaultType:"textfield",items:[{xtype:"textfield",fieldLabel:"文件路径",id:"filePath_qry"},{xtype:"textfield",fieldLabel:"描述",id:"desc_qry"}]}]}]})]}]})}return{initComponent:k}})();