define(["./utils"],function(h){var c="1",e={},j={getModal:function(){return $("#userinfo")},getUserName:function(){return $("#user-info-form input[name=userName]")},getUserFullName:function(){return $("#user-info-form input[name=userFullName]")},getFixNo:function(){return $("#user-info-form input[name=fixedNo]")},getMobileNo:function(){return $("#user-info-form input[name=mobileNo]")},getEmail:function(){return $("#user-info-form input[name=email]")},getOldPsd:function(){return $("#psd-form input[name=oldPsd]")},getNewPsd:function(){return $("#psd-form input[name=newPsd]")},getRetypePsd:function(){return $("#psd-form input[name=retypeNewPsd]")},getUserinfoInputs:function(){return $("#user-info-form input")},getPsdInputs:function(){return $("#psd-form input")},getSubmitBtn:function(){return $("#submit-userinfo")},getAllTabLi:function(){return $("#info-content .nav li")},getMask:function(){return $("#userinfo-mask")}};var f=function(k,l){k.blur(l);k.change(l);k.keyup(l);k.on("dovalidate",l)};var b=function(m,l){var k=function(){var o=$(this),p=o.val(),n=o.parent();if(l(p)){n.removeClass("has-error")}else{n.addClass("has-error")}};f(m,k)};var g=function(l){var k=true;$.each(l,function(n,m){var o=$(m);o.trigger("dovalidate");if(o.parent().hasClass("has-error")){k=false}});return k};var a=function(){var k,m,l;if(g(j.getUserinfoInputs())){k=j.getMobileNo().val();m=j.getFixNo().val();l=j.getEmail().val();i(true);$.ajax({type:"POST",dataType:"json",data:{mobile:k,tel:m,email:l},url:eastcom.baseURL+"/sysmng/security/updateBasicInfo",success:function(n){h.showMsg("success",n.msg);i(false)},failure:function(){h.showMsg("danger","保存失败");i(false)}})}};var d=function(){var k,l;if(!g(j.getPsdInputs())){var m=validatePwd_util(j.getUserName().attr("value"),j.getNewPsd().val(),j.getUserFullName().attr("value"));if(m){alert(m)}return}else{k=j.getOldPsd().val();l=j.getNewPsd().val();i(true);$.ajax({type:"POST",dataType:"json",data:{sendOldPassword:k,password:l},url:eastcom.baseURL+"/sysmng/security/extension/updatePassword",success:function(n){if(n.success=="true"){window.location.href=eastcom.baseURL+"/logout"}else{h.showMsg("danger",n.msg)}i(false)},failure:function(){h.showMsg("danger","保存失败");i(false)}})}};var i=function(k){if(k){j.getMask().removeClass("hide")}else{j.getMask().addClass("hide")}};e.toggle=function(){j.getModal().modal("toggle")};e.init=function(){b(j.getFixNo(),function(k){if(k&&k.length){return new RegExp("^\\(?\\d{3,4}[-\\)]?\\d{7,8}$").test(k)}else{return true}});b(j.getMobileNo(),function(k){if(k&&k.length){return new RegExp("^0?\\d{11}$").test(k)}else{return true}});b(j.getEmail(),function(k){if(k&&k.length){return new RegExp("^[a-zA-Z0-9_+.-]+@([a-zA-Z0-9-]+.)+[a-zA-Z0-9]{2,4}$").test(k)}else{return true}});b(j.getOldPsd(),function(k){return !!(k&&k.length)});b(j.getNewPsd(),function(m){var k=false;var l=validatePwd_util(j.getUserName().attr("value"),m,j.getUserFullName().attr("value"));if(l){k=false}else{k=true}return k});b(j.getRetypePsd(),function(l){var k=false;if(l&&l.length>=6){k=(l==j.getNewPsd().val())}return k});j.getAllTabLi().on("click",function(){var l=$(this).attr("name"),k=l.substr(l.length-1,1);if(k=="1"){j.getSubmitBtn().addClass("hide")}else{j.getSubmitBtn().removeClass("hide")}c=k});j.getSubmitBtn().on("click",function(){if(c=="2"){a()}else{if(c=="3"){d()}}})};return e});