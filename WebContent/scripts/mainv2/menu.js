define(["./utils","./config","./menuitem","./tab"],function(s,t,u,d){var b={},c=[],h=null,f=0,k={getMenuCnt:function(){return $("#menu")},getMenuNav:function(){return $("#nav")},getMenuPanel:function(){return $("#menu-panel")},getLeftBtn:function(){return $("#menu-left-narrow")},getRightBtn:function(){return $("#menu-right-narrow")}},l={margin_right:65},e={0:"glyphicon-leaf",1:"glyphicon-book",2:"glyphicon-tags",3:"glyphicon-inbox",4:"glyphicon-flag",5:"glyphicon-lock",6:"glyphicon-align-justify",7:"glyphicon-list-alt",8:"glyphicon-adjust",9:"glyphicon-indent-right"};var a=function(w){$.ajax({type:"POST",url:eastcom.baseURL+"/loginExtension/getCurrentUserTreeResources",dataType:"json",success:function(x){if(s.validateAjaxRs(x,"用户菜单加载失败")){$.each(x.data,function(z,A){var y=u.create(A);c.push(y)});w(c)}}})};var q=function(z,y){var B=k.getMenuNav().empty(),D=y*t.menu_num,w=(y+1)*t.menu_num;if(z&&z.length){if(w>z.length){w=z.length}for(var x=D;x<w;x++){var A=z[x];if(A.isMenu()){var C=s.getTplDom("top-menu-tpl",{nameCn:A.nameCn});if(A.isWebPage()){C.find(".top-menu-arrowdown").remove()}A.bindDom(C);B.append(C)}}}n(y);f=y};var o=function(){var w=k.getMenuNav();k.getMenuCnt().on("mouseenter",function(y){var x=s.is(y.target,"li","#menu");if(x){v(x)}}).on("mousemove",function(y){var x=s.is(y.target,"li","#menu");if(x){v(x)}}).on("mouseleave",function(x){w.find("li.active").removeClass("active");h=null;m(false)}).on("click","li",function(){var x=$(this),y=x.data("obj");if(y.isWebPage()&&y.isEnable()){d.add(y)}});k.getLeftBtn().on("click","span",function(x){q(c,f-1)});k.getRightBtn().on("click","span",function(x){q(c,f+1)});k.getMenuPanel().on("click","a",function(x){var y=$(this).data("obj");if(y.isWebPage()){if(y.isEnable()){d.add(y)}}else{r(y)}}).on("click","h5 span",function(y){var x=$(this);if(x.hasClass("click")){var A=s.is(x[0],".menu-level-2","#menu-panel");var z=A.data("obj");if(z.isWebPage()){if(z.isEnable()){d.add(z)}}else{r(z)}}})};var r=function(A){var z=A.getDom(),B=s.is(z[0],".menu-level-2","#menu-panel");if(B){var w=B.find("h5").empty();var y=p(A);y.shift();$.each(y,function(C,E){var D=s.getTplDom("menu-level2-title-inner-tpl",{nameCn:E.nameCn,type:C==(y.length-1)?"current":"click"});if(C>0){w.append(" - ")}w.append(D)});var x=B.find("[name=menu-level3-cnt]").empty();g(A.childs,x)}};var p=function(x,w){if(!w){w=[x]}else{w.push(x)}if(x.parent){return p(x.parent,w)}else{return w.reverse()}};var v=function(x){var y=k.getMenuNav();if(x){var w=x.data("obj");if(w!=h){y.find("li.active").removeClass("active");x.addClass("active");if(w.isWebPage()){x.addClass("active-page")}h=w;i(w,x)}}};var j=function(x){var w=x.position(),z=w.left,y=k.getMenuPanel().outerWidth();wWidth=$(window).width();if((z+y+l.margin_right)<=wWidth){return{left:z,radius:"right"}}else{var A=x.width();if((z+A/2+y/2+l.margin_right)<=wWidth){return{left:z+A/2-y/2,radius:"all"}}else{return{left:z+x.width()-y,radius:"left"}}}};var g=function(x,w){$.each(x,function(z,A){var y=s.getTplDom("menu-level3-tpl",{nameCn:A.nameCn,disabledclass:A.isDisabled()?"disabled":""});A.bindDom(y);w.append(y)})};var i=function(A,w){var x=k.getMenuPanel(),y=A.childs;x.empty();if(y&&y.length){var z=j(w);$.each(y,function(C,F){var D=s.getTplDom("menu-level2-tpl");var E=D.find("[name=menu-level3-cnt]");g(F.childs,E);var B=D.find("h5");B.append(s.getTplDom("menu-level2-title-inner-tpl",{nameCn:F.nameCn,type:F.isWebPage()?"click":"current"}));F.bindDom(D);x.append(D)});x.removeClass("menu-panel-radius-left");x.removeClass("menu-panel-radius-right");x.removeClass("menu-panel-radius-all");x.addClass("menu-panel-radius-"+z.radius);m(true);x.stop(true,true).animate({left:z.left},200)}else{m(false)}};var m=function(x){var w=k.getMenuPanel();if(x){w.show()}else{w.hide()}};var n=function(x){var y=c,z=k.getLeftBtn().find("span"),w=k.getRightBtn().find("span");if(y&&y.length&&y.length>t.menu_num){if(x==0){z.hide();w.show()}else{if((x+1)==Math.ceil(y.length/t.menu_num)){z.show();w.hide()}else{z.show();w.show()}}}else{z.hide();w.hide()}};b.init=function(){o();a(function(w){q(w,0)})};return b});