var AppBox=function(d){var v=false;var u=this;var q=[];var e=function(){return d.appsContainer.getSlideBox()};var r=function(){b();var A=n();var B=d.screenList+" ul";$(B).html(A);$(B).append("<li id='"+d.addScreenBtn+"' class='no-draggable-holder' title='"+PD_ADD_PAGE+"'></li>");var z=e().getCursor();var C=d.screenPageId+" "+d.screenList+" ul li.minscreenceil";$(C).eq(z).addClass("current");i()};var b=function(){var z=y();$(d.appCateList+" ul").html(z)};var g=function(A){var z=false;var B=[];$.each(q,function(C,D){if(D.id==A){B=D.items;z=true;return false}});return z?B:null};var f=function(){return d.appsContainer.getCurrentPage().getItems().length};var i=function(){$(d.appBtn).die("click");$(d.appBtn).live("click",function(){$(d.desktopSetting+" > #bar > div.active").removeClass("active");$(this).addClass("active");var B=$(d.appPageId).css("display");if(B=="none"){$(d.screenPageId).hide();$(d.appPageId).show();$(d.appCateList+" ul li a").eq(0).trigger("click")}});$(d.screenBtn).die("click");$(d.screenBtn).live("click",function(){$(d.desktopSetting+" > #bar > div.active").removeClass("active");$(this).addClass("active");var C=$(d.screenPageId).css("display");if(C=="none"){$(d.appPageId).hide();$(d.screenPageId).show()}var B=d.screenPageId+" "+d.screenList+" ul li.minscreenceil";$(B).removeClass("current");$(B).eq(e().getCursor()).addClass("current")});j();$("#"+d.addScreenBtn).die("click");$("#"+d.addScreenBtn).live("click",function(){var B=function(F){var E=d.screenPageId+" "+d.screenList+" ul";var C=$(E);var D=0;var G=$('<li class="minscreenceil" index="'+F.order+'">'+(parseInt(F.order)+1)+"</li>");G.insertBefore("#"+d.addScreenBtn);var H=d.screenPageId+" "+d.screenList+" ul li.minscreenceil";$(H).removeClass("current");$(H).eq(F.order).addClass("current")};d.appsContainer.addNewPage(B)});var z=$(d.screenPageId+" "+d.screenList+" ul li.minscreenceil");z.die("mouseenter");z.live("mouseenter",function(){$(this).css({"font-size":"45px"});if($("span.closebtn",this).length<=0){$(this).append("<span class='closebtn' title='"+PD_REMOVE_PAGE+"'></span>")}$("span.closebtn",this).show()});z.die("dblclick");z.live("dblclick",function(){var B=$(this).attr("index");e().scroll(B);z.removeClass("current");z.eq(B).addClass("current")});z.find("span").die("click");z.find("span").live("click",function(){if(confirm(PD_REMOVE_PAGE_CONFIRM)){var C=$(this).parent("li");var B=C.index("li.minscreenceil");var D=function(){e().removeScreen(B);h(PD_REMOVE_PAGE_SUCCESS);C.remove();s(z);e().scroll(0);z.removeClass("current");z.eq(0).addClass("current")};d.appsContainer.removePage(d.appsContainer.getPage(B),D)}});z.die("mouseleave");z.live("mouseleave",function(){$(this).css({"font-size":""});$("span.closebtn",this).hide()});var A=d.appCateList+" ul li a";$(A).die("click");$(A).live("click",function(){$(A).removeClass("current");$(this).addClass("current");var E=$(this).attr("id");var B=g(E);if(B==null){B=m(E);var D={id:E,items:B};q.push(D)}var C=c(B);$(d.appListBox+" ul").html(C)});$(d.appListBox+" ul li").die("click");$(d.appListBox+" ul li").live("click",function(){if($(this).data("status")&&$(this).data("status")=="die"){return false}var F=$(this).find("a");var H=F.attr("id");var G=F.attr("title");var C=F.attr("name");var B=F.attr("appurl");var D=F.attr("imageName");if(d.appsContainer.getCurrentPage()==null){alert(PD_NO_PAGE_MSG);return false}if(f()>=d.SCREEN_MAX_APP_NUM){var E=eastcom.sprintf(PD_APP_LIMIT,d.SCREEN_MAX_APP_NUM);if(!confirm(E)){return}}if(D==null||D==""||D=="null"){D="bigdefault.png"}Desktop.appsContainer.getCurrentPage().addAppIcon({id:H,nameCn:G,name:C,location:B,image:D},function(){h(PD_APP_ALREADY_ADD)},function(){h(PD_APP_ADD_FAILURE)});$(this).data("status","die");$(this).fadeOut(($.browser.msie?1:300),function(){$(this).remove()})});$(d.closeBoxId).bind("click",function(){k()});x()};var s=function(z){$(z).each(function(A){$(this).text(A+1);$(this).attr("index",A)})};var m=function(A){var z=[];var B=d.getMenuDatas();$.each(B,function(D,E){if(E.pid==A){var C=E.items;$.each(C,function(F,G){if(G.kind=="0"){if(G.isWebpage=="1"){z.push(G)}else{z=z.concat(m(G.id))}}});return false}});return z};var l=function(){var C=[];var B=e().getCursor();var z=e().getScreen(B);var A=$(z).find("ul li");$.each(A,function(E,F){var G=$(F).data("appIcon");if(G.isApp()){C.push(G.getData().resId)}else{var D=G.getData().items;$.each(D,function(H,I){C.push(I.resId)})}});return C};function o(z){var A=l();var B=$.inArray(z,A);return B!=-1?true:false}var c=function(z){var A="";$.each(z,function(C,D){var E=D.id;if(!o(E)&&D.isShowDesktop=="1"){var B=eastcom.baseURL+"/static/images/common/appicons/"+((D.image!=null&&D.image!="")?D.image:"bigdefault.png");A+='<li><a id="'+E+'" name="'+D.name+'" title="'+D.nameCn+'" hidefocus="true" href="javascript:;" appurl="'+D.location+'" imageName="'+D.image+'">';A+='<img align="absMiddle" width="48" height="48" src="'+B+'" />';A+='<span class="lleft"><span class="lright">'+D.nameCn+"</span></span>";A+="</a></li>"}});return A};var n=function(){var B="";var z=e().getCount();for(var A=0;A<z;A++){B+='<li class="minscreenceil" index='+A+">"+(A+1)+"</li>"}return B};var j=function(){var z=d.screenPageId+" "+d.screenList+" ul";$(z).sortable({cursor:"move",tolerance:"pointer",cancel:"#"+d.addScreenBtn,stop:function(){var B=new Array();$(this).find("li:not(:last-child)").each(function(){B.push($(this).attr("index"))});e().sortScreen(B);$(this).find("li").each(function(D){$(this).attr("index",D)});var C=[];$("#container .screen ul").each(function(D,E){C.push($(this).attr("id")+":"+D)});var A=a(C,function(){h(PD_APP_ORDER_CHANGED)})}})};var a=function(z,A){$.ajax({type:"POST",dataType:"json",data:{serializeIds:z.join(",")},url:eastcom.baseURL+"/desktop/serializeScreen",success:function(B){if(B.success=="true"){A()}}})};var y=function(){var z="";var A=d.getMenuDatas();$.each(A,function(C,E){if(E.pid==parent.Eastcom.firstMenuPid){var B=E.items;size=B.length;B.reverse();jQuery.each(B,function(F,G){var H=d.appIconPath+(G.image!=undefined&&G.image!=""?G.image:"default.png");z+='<li><a id="'+G.id+'" title="'+G.nameCn+'" href="javascript:;" hidefocus="true"><img src="'+H+'" align="absMiddle" width="20" height="20" /> '+G.nameCn+"</a></li>"});var D=d.APP_ITEM_HEIGHT*B.length;$(d.appCateList+" ul").attr("scrollHeight",D);return false}});return z};var x=function(){var A=$(d.appCateList+" .scroll-up:first");var E=$(d.appCateList+" .scroll-down:first");var B=$(d.appCateList+" ul");var C=B.attr("scrollHeight");var D=$("#app_cate_list").height();if(D<C){var z=D-A.outerHeight(true)-E.outerHeight(true)-14;B.height(z);A.show();E.show()}else{A.hide();E.hide()}p(d.appCateList)};var p=function(z){$(z+" > .scroll-up:first").hover(function(){$(this).addClass("scroll-up-hover")},function(){$(this).removeClass("scroll-up-hover")});$(z+" > .scroll-up:first").click(function(){var A=$(z+" > ul:first");A.animate({scrollTop:(A.scrollTop()-d.SCROLL_HEIGHT)},600)});$(z+" > .scroll-down:first").hover(function(){$(this).addClass("scroll-down-hover")},function(){$(this).removeClass("scroll-down-hover")});$(z+" > .scroll-down:first").click(function(){var A=$(z+" > ul:first");A.animate({scrollTop:(A.scrollTop()+d.SCROLL_HEIGHT)},600)})};var h=function(A){if(!A){return}var z=$("#portalSettingMsg");z.html(A).show();setTimeout(function(){z.empty().hide()},2000)};var t=function(){$(d.appBtn).addClass("active");$(d.appBtn).trigger("click");if(!$(d.appCateList).find("ul").children().length){b()}if($(d.appCateList+" ul li a").length>0){$(d.appCateList+" ul li a:first").trigger("click")}var B=(window.innerWidth||(window.document.documentElement.clientWidth||window.document.body.clientWidth));var C=(window.innerHeight||(window.document.documentElement.clientHeight||window.document.body.clientHeight));var A="-"+Math.round(d.pWidth/2)+"px";var z="-"+Math.round(d.pHeight/2)+"px";$(d.panelId).css({top:"50%",left:"50%","margin-left":A,"margin-top":z}).show({complete:function(){v=true}})};var k=function(){$(d.panelId).hide({complete:function(){v=false}})};var w=function(){$(d.appCateList+" ul li a.current").trigger("click")};r();this.show=t;this.hide=k;this.isShow=function(){return v};this.refreshCurrentList=w};