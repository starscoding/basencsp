var AppPage=function(d){var j=this;var c;var k=null;var g=[];var m=function(){c=$("<ul id='"+d.id+"'></ul>");$.each(d.items,function(n,p){var o=new AppIcon(p);o.setParent(j);i(o)});c.data("appPage",j);h()};var e=function(){var o=f();var p=[];var n=0;$.each(o,function(r,q){var s=$(q);if(s.css("display")=="none"){setTimeout(function(){s.remove()},1000)}else{var t=s.data("appIcon");p.push(t.getData().drId+":"+n);t.setOrder(n);n+=1}});$.ajax({type:"POST",url:eastcom.baseURL+"/desktop/sortUserDesktopIcons",dataType:"json",data:{desktopId:d.id,orders:p.join()},success:function(q){}})};var h=function(){var o=eastcom.baseURL+"/static/images/themes/blue/desktop/trash.png";var n=eastcom.baseURL+"/static/images/themes/blue/desktop/trash_hover.png";k=$('<img class="trash" src="'+o+'"></img>');c.append(k);k.droppable({scope:"outer",over:function(){k.attr("src",n)},out:function(){k.attr("src",o)},drop:function(q,r){var p=r.draggable.data("appIcon");r.draggable.hide();$.ajax({type:"POST",dataType:"json",data:{drId:p.getData().drId},url:eastcom.baseURL+"/desktop/deleteIconFromDesktop",success:function(s){if(s.success=="true"){k.attr("src",o);r.draggable.remove();e();l(p)}}})}})};var l=function(n){var o=0;var q=n.getData();for(var p=0;p<g.length;p++){if(q.drId==g[p].getData().drId){o=p;break}}g.splice(o,1)};var i=function(n){if(c){c.append(n.getDom());g.push(n)}};var a=function(q,o,p){if(c){var n=f().length;$.ajax({type:"POST",url:eastcom.baseURL+"/desktop/addDesktopIcon",dataType:"json",data:{desktopId:d.id,resourceId:q.id,order:n},success:function(r){if(r.success=="true"){var t={deskId:d.id,deskOrder:d.order,drId:r.data,floderName:null,parentId:null,order:n,resId:q.id,name:q.name,nameCn:q.nameCn,image:q.image,location:q.location};var s=new AppIcon(t);s.setParent(j);i(s);if(typeof(o)=="function"){o()}}else{if(typeof(p)=="function"){p()}}}})}};var f=function(){var n=c.find("li.block:not(.ui-draggable-dragging)");return n};var b=function(){return g};m();this.getDom=function(){return c};this.getData=function(){return d};this.sort=e;this.addAppIcon=a;this.getTrash=function(){return k};this.removeItem=l;this.getItems=b};