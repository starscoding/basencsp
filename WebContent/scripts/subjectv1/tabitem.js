define(["./utils","text!./template/tab.html"],function(g,h){var e={tab:$(h).find("#tab-tpl").html(),iframe:$(h).find("#iframe-tpl").html()},i=0;var f={show:function(){},hide:function(){},destroy:function(){}};var c=function(l,o){var p=this,n,m,j=o.previousTab,r=o.closable,q=o.destroyable;n=g.getTplDom(e.tab,{nameCn:l.nameCn});m=g.getTplDom(e.iframe);p._tabDom=n;p._tabIframe=m;p.loaded=false;p._menu=l;if(j){p.setPrevious(j);j.setNext(p)}if(r){var k=m.children(".close").removeClass("hide");k.on("click",function(){p.destroy()})}if(q==false){p.__destroyable=false}else{p.__destroyable=true}};var d=function(k){var j=k.find("iframe")[0];j.onload=function(){var l=this;eastcom.syncIframeHeight(l)}};var b=function(){var p=$(".head"),k=$("#tabs"),q=$("#foot"),l=$("#left-tree-cnt");var o=$(window).height(),m=p.outerHeight(),r=k.outerHeight(),j=q.outerHeight(),n=l.outerHeight();o-=m;o-=(k.is(":visible")?r:0);o-=(q.is(":visible")?j:0);i=o>n?o:n};var a=function(l,j){var k=l.find("iframe");k=k[0];k.src=j};$.extend(c.prototype,{show:function(){$("#tabs-iframe-cnt .tab-content").removeClass("active");this._tabDom.addClass("active");this._tabIframe.addClass("active");if(!this.loaded){if(i==0){b();$(window).on("resize",b)}a(this._tabIframe,this._menu.location);d(this._tabIframe);this.loaded=true}this._tabIframe.find("iframe").css({"min-height":i});f.show(this)},hide:function(){var j=this.getPrevious();this._tabDom.removeClass("active");this._tabIframe.removeClass("active");j?j.show():[];f.hide(this)},destroy:function(){var l=this,k=l.getPrevious(),j=l.getNext();if(!l.destroyable()){return}l._tabDom.remove();l._tabIframe.remove();if(k){k.setNext(j);k.show()}if(j){j.setPrevious(k)}l.destroyed=true;f.destroy(this)},render:function(k,j){k.append(this._tabDom);j.append(this._tabIframe)},matchId:function(j){return this._menu.id===j},setLocation:function(j){a(this._tabIframe,j)},setPrevious:function(j){this.__prevoius=j},getPrevious:function(){return this.__prevoius},setNext:function(j){this.__next=j},getNext:function(){return this.__next},destroyable:function(){return this.__destroyable},isDestroyed:function(){return !!this.destroyed},getWindowObj:function(){var j=null;if(this._tabIframe){var k=this._tabIframe.children("iframe")[0];j=k.contentWindow}return j},callIframeFn:function(k,j){var m=this.getWindowObj();var l=m[k];if(l&&$.type(l)=="function"){l.apply(m,j)}}});c.create=function(k,j){return new c(k,j?j:{})};c.updateMinHeight=function(j){if(j>i){i=j;$("#tabs-iframe-cnt iframe").css({"min-height":i})}};c.setCallback=function(j,k){f[j]=k};return c});