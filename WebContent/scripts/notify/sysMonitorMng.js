Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.components",eastcom.baseURL+"/static/commonjs/components");Ext.Loader.setPath("Ext.monitor",eastcom.baseURL+"/scripts/monitor/components");Ext.require(["Ext.grid.*","Ext.data.*","Ext.ux.RowExpander","Ext.view.View","Ext.ux.DataView.DragSelector","Ext.ux.DataView.LabelEditor","Ext.components.BaseDataComboBox","Ext.components.DateTimeField","Ext.monitor.*"]);eastcom.modules.sysMonitorMng=(function(){var f=null;var b={};Ext.define("ServerModel",{extend:"Ext.data.Model",fields:[{name:"text"},{name:"id.indicator"}]});Ext.define("SysMonitorN",{extend:"Ext.data.Model",fields:[{name:"id",type:"object"},{name:"id.ip",type:"string"},{name:"id.indicator",type:"string"},{name:"id.createTime",type:"string"},{name:"valueThr",type:"string"},{name:"exception",type:"string"},{name:"remark",type:"string"},{name:"nextTime",type:"string"},{name:"thresholdRef",type:"string"},{name:"useKind",type:"string"},{name:"operator",type:"string"}]});var h=Ext.create("Ext.data.TreeStore",{autoLoad:true,autoSync:true,proxy:{type:"ajax",url:eastcom.baseURL+"/monitor/findServerByTreeView",reader:{type:"json",root:"data"}},sorters:[{property:"leaf",direction:"ASC"}],root:{text:"所有主机",expanded:true}});var c=Ext.create("Ext.data.Store",{model:"ServerModel",autoLoad:true,proxy:{type:"ajax",url:eastcom.baseURL+"/monitor/findServerViewData",reader:{type:"json",idProperty:"oid",root:"data"}}});var g=Ext.create("Ext.data.Store",{id:"monitorNStore2",model:"SysMonitorN",pageSize:eastcom.pageSize,autoLoad:true,proxy:{type:"ajax",url:eastcom.baseURL+"/monitor/queryOverSysMonitorNList",reader:{type:"json",idProperty:"oid",root:"data"},actionMethods:{read:"POST"},timeout:180000}});var a=Ext.create("Ext.tree.TreePanel",{region:"west",autoScroll:true,rootVisible:true,title:"主机树图",border:false,animate:true,lines:true,store:h,width:300,listeners:{itemclick:function(j,k){if(k.data.leaf){c.load({params:{ip:k.data.text}})}else{if(k.data.text=="所有主机"){c.load()}else{c.load({params:{useKind:k.data.text}})}}}}});var e=Ext.create("Ext.Panel",{region:"center",id:"images-view",title:"主机列表",tbar:[{id:"reloadBut",text:"返回",handler:function(){c.load()}}],items:[Ext.create("Ext.view.View",{store:c,tpl:['<tpl for=".">','<div class="thumb-wrap" id="{oid:stripTags}">','<div class="thumb"><img src="http://172.16.31.102/modelImg/mycp.jpg" title="{text:htmlEncode}"></div>','<span class="x-editable" style="text-align:center;">{text:htmlEncode}</span>',"</div>","</tpl>",'<div class="x-clear"></div>'],multiSelect:true,fit:true,trackOver:true,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",emptyText:"No images to display",plugins:[Ext.create("Ext.ux.DataView.DragSelector",{}),Ext.create("Ext.ux.DataView.LabelEditor",{dataIndex:"text"})],prepareData:function(j){return j},listeners:{selectionchange:function(l,k){if(k.length>0){if(!k[0].get("id")){var n=k[0].get("text");c.load({params:{ip:n}})}else{var n=k[0].get("id").ip;var j=k[0].get("id").indicator;g.load({params:{"id.ip":n,"id.indicator":j}});if(Ext.getCmp("monitorNServerWin")==null){var m=Ext.create("Ext.monitor.monitorNServerWin");m.show(undefined,function(){m.load({ip:n,indicator:j})})}}}else{g.load()}}}})]});var d=Ext.create("Ext.grid.Panel",{region:"south",title:"异常列表",store:g,height:200,columnLines:true,columns:[{text:MONITOR_USE_KIND,flex:1,dataIndex:"useKind",sortable:false,align:"center"},{text:MONITOR_IP,flex:1,sortable:false,dataIndex:"id.ip",minWidth:250},{text:MONITOR_INDICATOR,sortable:false,flex:1,dataIndex:"id.indicator",align:"center"},{text:MONITOR_VALUE_THR,flex:1,dataIndex:"valueThr",sortable:false,align:"center"},{text:MONITOR_THRESHOLD_REF,flex:1,dataIndex:"thresholdRef",sortable:false,align:"center"}],animCollapse:false});function i(){Ext.create("Ext.Viewport",{layout:{type:"border",padding:5},items:[a,e,d]})}return{initComponent:i}})();