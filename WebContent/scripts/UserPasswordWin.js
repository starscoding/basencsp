function UserPasswordWin(d){var f=this;var j=eastcom.getUserInfo();var k=function(){if(!d){d={masked:false}}if(d.masked){$("body").mask()}var m="";m+='<form class="userInfoBaseForm" style="display:block;" name="passwordForm">';m+='<p class="infoLine"><label class="infoLabel">'+UE_CURRENT_PWD+'：</label><input class="infoInput password" type="password" name="oldPassword"  maxlength="16"/><a class="errorIcon" name="psdTip"></a></p>';m+='<p class="infoLine"><label class="infoLabel">'+UE_NEW_PWD+'：</label><input class="infoInput password" type="password"  name="password" maxlength="16"/><a class="errorIcon" name="newPsdTip"></a></p>';m+='<p class="infoLine"><label class="infoLabel"></label><a class="prompt">'+UE_PWD_NOTICE1+"</a></p>";m+='<p class="infoLine"><label class="p_level_label infoLabel">'+PWD_STRENGTH+'：</label><a name="pLevel" class="p_level" alt=""></a></p>';m+='<p class="infoLine"><label class="infoLabel"></label><a class="prompt">'+UE_PWD_NOTICE2+"</a></p>";m+='<p class="infoLine"><label class="infoLabel">'+UE_NEW_PWD_CONFIRM+'：</label><input class="infoInput password" type="password" name="retypePassword" maxlength="16"/><a class="errorIcon" name="retypePsdTip"></a></p>';m+='<p class="infoLine" name="btnsLine" style="display:block; text-align:center">';m+='<button name="submitPassword"  class="buttonWidth windowCommonBtnCls1 windowCommonBtnCls2" type="button">'+BUTTON_OK+"</button>";m+="</p>";m+="</form>";d.closable=false;d.content=$(m);d.height=250;d.width=300;d.style={"z-index":90001};if(!typeof(d.isFirstChange)=="boolean"){d.isFirstChange=false}};var h=function(){var q=c();var o=$("#"+q+" :password");var r=$("#"+q+" :input[name=oldPassword]");var n=$("#"+q+" :input[name=password]");var p=$("#"+q+" :input[name=retypePassword]");var m=$("#"+q+" button[name=submitPassword]");m.click(function(){a()});o.focus(function(){var s=$(this);s.removeClass();s.addClass("password");s.addClass("infoInput");s.addClass("focusInput")});r.blur(function(){var s=$(this);s.removeClass();s.addClass("password");s.addClass("infoInput");if(this.value==""){s.addClass("errorInput");l(1,MSG_FIELD_NOTNULL)}else{l(1,null)}i()});n.change(function(){i()});n.keyup(function(){i()});n.blur(function(){i()});p.change(function(){i()});p.keyup(function(){i()});p.blur(function(){i()})};var c=function(){return f.winId+"-contentContainer"};var l=function(n,p){var m=c();var o=null;switch(n){case 1:o=$("#"+m+" [name=psdTip]");break;case 2:o=$("#"+m+" [name=newPsdTip]");break;case 3:o=$("#"+m+" [name=retypePsdTip]");break}if(o&&o.length){if(p&&p.length){o.attr("title",p);o.show()}else{o.hide()}}};var g=function(){var q=c();var m=true;var o=$("#"+q+" :password");var s=$("#"+q+" :input[name=oldPassword]");var n=$("#"+q+" :input[name=password]");var p=$("#"+q+" :input[name=retypePassword]");$.each(o,function(v,u){if(u.value.length==0){$(u).removeClass();$(u).addClass("password");$(u).addClass("infoInput");$(u).addClass("errorInput");m=false}});if(s.attr("value")==""){s.addClass("errorInput");l(1,MSG_FIELD_NOTNULL);alert(MSG_FIELD_NOTNULL);return false}var t=e(true);if(t){alert(t);return false}var r=n.attr("value");if(r.indexOf(j.userName)!=-1||r.indexOf(j.mobileNo)!=-1){m=false}if(b(n.attr("value"))<3){m=false}if(n.attr("value")!=p.attr("value")){m=false}if(n.attr("value")==s.attr("value")){m=false}return m?{sendOldPassword:s.attr("value"),password:n.attr("value")}:false};function i(m){var r="";var p=c();var q=$("#"+p+" :input[name=oldPassword]");var n=$("#"+p+" :input[name=password]");var o=$("#"+p+" :input[name=retypePassword]");n.removeClass();n.addClass("password");n.addClass("infoInput");o.removeClass();o.addClass("password");o.addClass("infoInput");e()}function e(m){var s="";var p=c();var r=$("#"+p+" :input[name=oldPassword]");var n=$("#"+p+" :input[name=password]");var o=$("#"+p+" :input[name=retypePassword]");b(n.attr("value"));var q=validatePwd_util(j.username,n.attr("value"),j.fullName);s=q;if(q){n.addClass("errorInput");l(2,s);if(m){return s}}else{if(r.val()==n.val()){n.addClass("errorInput");l(2,UD_PSD_ERRO_MSG2);s=UD_PSD_ERRO_MSG2;if(m){return s}}else{l(2,null)}}if(o.attr("value")!=""){if(n.attr("value")!=o.attr("value")){o.addClass("errorInput");l(3,UD_PSD_ERRO_MSG3);s=UD_PSD_ERRO_MSG3}else{l(3,null)}}else{o.addClass("errorInput");l(3,MSG_FIELD_NOTNULL);s=MSG_FIELD_NOTNULL}if(m){return s}}var b=function(p){var n=c();var m=$("#"+n+" a[name=pLevel]");m.removeClass();var o=validatePwdLevel_util(p);switch(o){case 1:m.addClass("p_level_l");break;case 2:m.addClass("p_level_m");break;case 3:m.addClass("p_level_h");break;default:m.addClass("p_level");break}return o};var a=function(){var m=g();m.isFirstChange=d.isFirstChange;if(m){jQuery.ajax({type:"POST",async:false,dataType:"json",data:m,url:Eastcom.baseURL+"/sysmng/security/extension/updatePassword",success:function(n){alert(n.msg);if(n.success=="true"){window.location.href=Eastcom.baseURL+"/logout"}},failure:function(){}})}};k();CommonWindow.call(f,d);h();f.initEvents=h;f.getContainerId=c};