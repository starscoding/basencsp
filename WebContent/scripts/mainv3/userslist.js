define(["./utils","text!./template/userslist.html"],function(c,e){var b={},h={getModal:function(){return $("#userslist")},getUl:function(){return $("#online-user-ul")},getMask:function(){return $("#userslist-mask")}},d={win:$(e).find("#userlist-win-tpl").html(),line:$(e).find("#online-user-detail-tpl").html()};var g=function(i){if(i){h.getMask().removeClass("hide")}else{h.getMask().addClass("hide")}};var a=function(){g(true);$.ajax({type:"POST",dataType:"json",data:{},url:eastcom.baseURL+"/loginExtension/getOnlineUsers",success:function(i){if(i.success="true"){f(i.data)}else{c.showMsg("danger","在线用户加载失败")}g(false)},failure:function(){g(false);c.showMsg("danger","在线用户加载失败")}})};var f=function(j){var i=h.getUl();i.empty();$.each(j,function(l,k){i.append(c.getTplDom(d.line,k))})};b.toggle=function(){h.getModal().modal("toggle");a()};b.init=function(){if(!h.getModal().length){$("body").append(d.win)}};return b});