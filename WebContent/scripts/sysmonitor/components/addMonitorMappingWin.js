Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.components","../../static/commonjs/components");var required='<span style="color:red;font-weight:bold" data-qtip="Required">*</span>';var currentRecord=null;function resetData(){currentRecord=null}Ext.regModel("ServerModel",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"text",type:"string"}]});Ext.regModel("IndicatorModel",{fields:[{name:"id",type:"string"},{name:"indicatorName",type:"string"},{name:"type",type:"string"},{name:"thresholdRef1",type:"string"},{name:"thresholdRef2",type:"string"},{name:"thresholdRef3",type:"string"},{name:"thresholdRef4",type:"string"}]});Ext.define("Ext.components.ServerComboBox",{extend:"Ext.form.field.ComboBox",xtype:"serverComboBox",blankText:MSG_FIELD_NOTNULL,typeAhead:true,editable:false,displayField:"name",valueField:"id",queryMode:"local",initComponent:function(){this.store=Ext.create("Ext.data.Store",{model:"ServerModel",proxy:{type:"ajax",actionMethods:{read:"POST"},url:eastcom.baseURL+"/sysmonitor/getAllMonitorServer"},autoLoad:true});this.callParent(arguments)}});Ext.define("Ext.components.IndicatorComboBox",{extend:"Ext.form.field.ComboBox",xtype:"indicatorComboBox",blankText:MSG_FIELD_NOTNULL,typeAhead:true,editable:false,displayField:"indicatorName",valueField:"id",queryMode:"local",initComponent:function(){this.store=Ext.create("Ext.data.Store",{model:"IndicatorModel",proxy:{type:"ajax",actionMethods:{read:"POST"},url:eastcom.baseURL+"/sysmonitor/getAllMonitorIndicator"},autoLoad:true});this.callParent(arguments)}});Ext.define("SysMonitorMain",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"serverId",type:"string"},{name:"serverName",type:"string"},{name:"indicatorId",type:"string"},{name:"indicatorName",type:"string"},{name:"instanceName",type:"string"},{name:"threshold1",type:"string"},{name:"threshold2",type:"string"},{name:"threshold3",type:"string"},{name:"threshold4",type:"string"},{name:"param1",type:"string"},{name:"param2",type:"string"},{name:"param3",type:"string"},{name:"remark",type:"string"}]});Ext.define("Ext.monitor.addMonitorMappingWin",{extend:"Ext.window.Window",requires:["Ext.form.*","Ext.window.*","Ext.components.BaseDataComboBox","Ext.ux.RowExpander"],baseCommonData:null,title:BUTTON_NEW,id:"addMonitorMappingWin",frame:false,layout:"fit",border:false,resizable:false,autoScroll:true,width:610,height:currentUserTheme=="neptune"?425:405,listeners:{show:function(){Ext.getBody().mask()},close:function(){Ext.getBody().unmask()}},initAddMonitorWinComponents:function(){var c;var b;var a;b=Ext.create("Ext.components.ServerComboBox",{id:"form.serverId",name:"serverId",fieldLabel:MONITOR_NAME,allowBlank:false,allFlag:false,afterLabelTextTpl:required,emptyText:MSG_CHOOSE_ONE,labelAlign:"right",anchor:"95%",listeners:{load:function(){}}});a=Ext.create("Ext.components.IndicatorComboBox",{id:"form.indicatorId",name:"indicatorId",fieldLabel:INDICATOR_NAME,allowBlank:false,allFlag:false,afterLabelTextTpl:required,emptyText:MSG_CHOOSE_ONE,labelAlign:"right",anchor:"95%",listeners:{select:function(g,e,d,h){var n=g.lastSelection[0].data.thresholdRef1;var m=g.lastSelection[0].data.thresholdRef2;var l=g.lastSelection[0].data.thresholdRef3;var k=g.lastSelection[0].data.thresholdRef4;var j=g.lastSelection[0].data.type;Ext.getCmp("form.threshold1").setValue(n);Ext.getCmp("form.threshold2").setValue(m);Ext.getCmp("form.threshold3").setValue(l);Ext.getCmp("form.serverId").setValue("");var i=Ext.getCmp("form.serverId").getStore().proxy;var f={type:j};i.extraParams=f;Ext.getCmp("form.serverId").getStore().load()}}});c=Ext.widget({xtype:"form",id:"addMainForm",region:"center",bodyStyle:{padding:"5px 5px 0px","overflow-x":"hidden","overflow-y":"auto"},items:[{xtype:"container",width:"100%",layout:"vbox",items:[{xtype:"container",width:"100%",flex:1,layout:"hbox",items:[{xtype:"fieldcontainer",flex:1,width:"100%",layout:"vbox",defaults:{width:"100%"},items:[{xtype:"textfield",id:"form.id",fieldLabel:THRESHOLD_REF_1,labelAlign:"right",hidden:true,anchor:"95%"},a,b,{xtype:"textfield",id:"form.instanceName",fieldLabel:INSTANCE_NAME,afterLabelTextTpl:required,labelAlign:"right",allowBlank:false,anchor:"95%"},{xtype:"textfield",id:"form.threshold1",fieldLabel:THRESHOLD_REF_1,labelAlign:"right",anchor:"95%",listeners:{focus:function(d,f,e){Ext.getCmp("form.threshold1").setValue("")}}},{xtype:"textfield",id:"form.threshold3",fieldLabel:THRESHOLD_REF_3,labelAlign:"right",anchor:"95%",listeners:{focus:function(d,f,e){Ext.getCmp("form.threshold3").setValue("")}}}]},{xtype:"container",flex:1,layout:"vbox",defaults:{width:"100%"},items:[{xtype:"textfield",id:"form.param1",fieldLabel:MONITOR_PARAM_1,labelAlign:"right",anchor:"95%"},{xtype:"textfield",id:"form.param2",fieldLabel:MONITOR_PARAM_2,labelAlign:"right",anchor:"95%"},{xtype:"textfield",id:"form.param3",fieldLabel:MONITOR_PARAM_3,labelAlign:"right",anchor:"95%"},{xtype:"textfield",id:"form.threshold2",fieldLabel:THRESHOLD_REF_2,labelAlign:"right",anchor:"95%",listeners:{focus:function(d,f,e){Ext.getCmp("form.threshold2").setValue("")}}},{xtype:"textfield",id:"form.editFlag",labelAlign:"right",allowBlank:false,hidden:true,value:"0",anchor:"95%"}]}]},{xtype:"fieldcontainer",flex:1,layout:"hbox",width:"100%",defaults:{width:"100%"},items:[{xtype:"textarea",id:"form.remark",fieldLabel:MONITOR_REMARK,labelAlign:"right",allowBlank:true,anchor:"95%"}]},{xtype:"fieldcontainer",flex:1,layout:"hbox",width:"100%",defaults:{width:"100%"},items:[{xtype:"label",id:"form.example",labelAlign:"center",allowBlank:false,margin:"0 0 0 60",text:"注：参数1:磁盘使用率 -- 填挂载点,网络流量 -- 网卡（ip）待定,IO负载 -- 硬盘 待定,进程 -- 进程信息（多个信息用!@#配置）;参数2:进程 -- 是否重启 0(不重启),1(重启);参数3:进程 -- 启动命令",anchor:"95%"}]}]}]});return c},loadServer:function(a){var c=this;resetData();currentRecord=a;c.setTitle(BUTTON_EDIT);var b=c.baseCommonData;Ext.Ajax.request({url:eastcom.baseURL+"/sysmonitor/queryMonitorMapping",method:"POST",params:{id:a.get("id")},success:function(e,f){Ext.getCmp("form.serverId").setReadOnly(true);Ext.getCmp("form.indicatorId").setReadOnly(true);Ext.getCmp("form.editFlag").setValue("1");var d=Ext.JSON.decode(e.responseText).data;var g={id:d.id,serverId:d.serverId,indicatorId:d.indicatorId,instanceName:d.instanceName,threshold1:d.threshold1,threshold2:d.threshold2,threshold3:d.threshold3,param1:d.param1,param2:d.param2,param3:d.param3,remark:d.remark};Ext.getCmp("form.id").setValue(g.id);Ext.getCmp("form.serverId").setValue(g.serverId);Ext.getCmp("form.indicatorId").setValue(g.indicatorId);Ext.getCmp("form.instanceName").setValue(g.instanceName);Ext.getCmp("form.threshold1").setValue(g.threshold1);Ext.getCmp("form.threshold2").setValue(g.threshold2);Ext.getCmp("form.threshold3").setValue(g.threshold3);Ext.getCmp("form.param1").setValue(g.param1);Ext.getCmp("form.param2").setValue(g.param2);Ext.getCmp("form.param3").setValue(g.param3);Ext.getCmp("form.remark").setValue(g.remark)},failure:function(d,e){}})},initComponent:function(){var a=this;a.items=[a.initAddMonitorWinComponents()];a.buttons=[{text:BUTTON_OK,handler:function(){var b=Ext.getCmp("addMainForm").getForm();if(b.isValid()==true){a.getEl().mask(MSG_DATA_SAVING);Ext.Ajax.request({url:eastcom.baseURL+"/sysmonitor/saveMonitorMapping",method:"POST",params:{id:Ext.getCmp("form.id").getValue(),serverId:Ext.getCmp("form.serverId").getValue(),indicatorId:Ext.getCmp("form.indicatorId").getValue(),instanceName:Ext.getCmp("form.instanceName").getValue(),threshold1:Ext.getCmp("form.threshold1").getValue(),threshold2:Ext.getCmp("form.threshold2").getValue(),threshold3:Ext.getCmp("form.threshold3").getValue(),param1:Ext.getCmp("form.param1").getValue(),param2:Ext.getCmp("form.param2").getValue(),param3:Ext.getCmp("form.param3").getValue(),remark:Ext.getCmp("form.remark").getValue(),editFlag:Ext.getCmp("form.editFlag").getValue()},success:function(e,f){var c=Ext.JSON.decode(e.responseText);if(c.success=="true"){var g={id:Ext.getCmp("form.id").getValue(),serverName:Ext.getCmp("form.serverId").getRawValue(),indicatorName:Ext.getCmp("form.indicatorId").getRawValue(),instanceName:Ext.getCmp("form.instanceName").getValue(),threshold1:Ext.getCmp("form.threshold1").getValue(),threshold2:Ext.getCmp("form.threshold2").getValue(),threshold3:Ext.getCmp("form.threshold3").getValue(),param1:Ext.getCmp("form.param1").getValue(),param2:Ext.getCmp("form.param2").getValue(),param3:Ext.getCmp("form.param3").getValue(),remark:Ext.getCmp("form.remark").getValue()};if(currentRecord){currentRecord.set("id",g.id);currentRecord.set("indicatorName",Ext.getCmp("form.indicatorId").getRawValue());currentRecord.set("instanceName",g.instanceName);currentRecord.set("threshold1",g.threshold1);currentRecord.set("threshold2",g.threshold2);currentRecord.set("threshold3",g.threshold3);currentRecord.set("param1",g.param1);currentRecord.set("param2",g.param2);currentRecord.set("param3",g.param3);currentRecord.set("remark",g.remark)}else{var d=Ext.create("SysMonitorMain",g);Ext.getCmp("sysMonitorMainGrid").getStore().insert(0,d)}Ext.Msg.show({title:MSG_SUCCESS,msg:c.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{Ext.Msg.show({title:MSG_FAILURE,msg:c.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}a.getEl().unmask();a.close()},failure:function(d,e){var c=Ext.JSON.decode(d.responseText);Ext.Msg.show({title:MSG_FAILURE,msg:c.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}})}else{Ext.Msg.show({title:MSG_TITLE,msg:MSG_ALL_CONDITIONS,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}},{text:BUTTON_CANCEL,handler:function(){Ext.getCmp("addMonitorMappingWin").close()}}];this.callParent()}});