Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.components","../../static/commonjs/components");var required='<span style="color:red;font-weight:bold" data-qtip="Required">*</span>';var currentRecord=null;function resetData(){currentRecord=null}Ext.define("SysMonitorNServer",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"type",type:"string"},{name:"remark",type:"string"}]});Ext.define("SysMonitorResourceConf",{extend:"Ext.data.Model",fields:[{name:"res_key",type:"string"},{name:"res_name",type:"string"},{name:"res_value",type:"string"}]});Ext.define("Ext.monitor.addServerWin",{extend:"Ext.window.Window",requires:["Ext.form.*","Ext.window.*","Ext.grid.*","Ext.data.*","Ext.util.*","Ext.components.BaseDataComboBox","Ext.ux.RowExpander"],baseCommonData:null,title:BUTTON_NEW,id:"addServerWin",frame:false,layout:"fit",border:false,resizable:false,autoScroll:true,width:760,height:currentUserTheme=="neptune"?465:445,listeners:{show:function(){Ext.getBody().mask()},close:function(){Ext.getBody().unmask()}},initAddServerWinComponents:function(){var e;var c;c=Ext.create("Ext.components.BaseDataComboBox",{parentName:"monitorUseKind",id:"form.type",name:"type",fieldLabel:MONITOR_USE_KIND,allowBlank:false,allFlag:false,labelAlign:"right",afterLabelTextTpl:required,emptyText:MSG_CHOOSE_ONE,anchor:"95%",value:""});var d=Ext.create("Ext.data.Store",{id:"resourceConfStores",autoLoad:true,autoSync:true,model:"SysMonitorResourceConf",proxy:{type:"memory"},data:[]});var b=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,saveBtnText:"确定",cancelBtnText:"取消",autoCancel:false});var a=Ext.create("Ext.grid.GridPanel",{id:"resourceConfGrid",renderTo:document.body,plugins:[b],width:"100%",height:"100%",frame:true,store:d,columns:[{text:MONITOR_IP,flex:1,width:130,sortable:true,dataIndex:"res_key",editor:Ext.create("Ext.components.BaseDataComboBox",{parentName:"monitorResourceConfKey",id:"form.res_key",name:"res_key",allFlag:false,labelAlign:"right",anchor:"95%"})},{text:MONITOR_PORT,width:220,sortable:true,dataIndex:"res_name",field:{xtype:"textfield"}},{text:MONITOR_ACCOUNT,width:220,sortable:true,dataIndex:"res_value",field:{xtype:"textfield"}}],dockedItems:[{xtype:"toolbar",items:[{text:"新增",icon:"../../static/images/common/icons/new.png",handler:function(){d.insert(0,new SysMonitorResourceConf());b.startEdit(0,0)}},"-",{itemId:"delete",text:"删除",icon:"../../static/images/common/icons/delete.png",disabled:true,handler:function(){var f=a.getView().getSelectionModel().getSelection()[0];if(f){d.remove(f)}}}]}]});a.getSelectionModel().on("selectionchange",function(f,g){a.down("#delete").setDisabled(g.length===0)});e=Ext.widget({xtype:"form",id:"addMainForm",region:"center",bodyStyle:{padding:"5px 5px 0px","overflow-x":"hidden","overflow-y":"auto"},fieldDefaults:{labelAlign:"top",msgTarget:"side"},items:[{region:"north",height:145,layout:"hbox",tbar:Ext.create("Ext.toolbar.Toolbar",{items:["资源基本信息"]}),bodyStyle:{padding:"5px 5px 5px 5px"},items:[{xtype:"container",width:"100%",layout:"vbox",items:[{xtype:"container",width:"100%",flex:1,layout:"hbox",items:[{xtype:"fieldcontainer",flex:1,width:"100%",layout:"vbox",defaults:{width:"100%"},items:[{xtype:"textfield",id:"form.id",fieldLabel:MONITOR_NO,labelAlign:"right",afterLabelTextTpl:required,emptyText:MSG_PLEASE_INSERT,allowBlank:false,anchor:"95%"},c]},{xtype:"container",flex:1,layout:"vbox",defaults:{width:"100%"},items:[{xtype:"textfield",id:"form.name",fieldLabel:MONITOR_NAME,labelAlign:"right",afterLabelTextTpl:required,emptyText:MSG_PLEASE_INSERT,allowBlank:false,anchor:"95%"},{xtype:"textfield",id:"form.editFlag",labelAlign:"right",allowBlank:false,hidden:true,value:"0",anchor:"95%"}]}]},{xtype:"fieldcontainer",flex:1,layout:"hbox",width:"100%",defaults:{width:"100%"},items:[{xtype:"textarea",id:"form.remark",fieldLabel:MONITOR_REMARK,labelAlign:"right",rows:2,allowBlank:true,anchor:"95%"}]}]}]},{region:"center",layout:"hbox",height:227,tbar:Ext.create("Ext.toolbar.Toolbar",{items:["资源属性"]}),bodyStyle:{padding:"5px 5px 5px 5px"},autoScroll:true,items:[a]}]});return e},loadServer:function(a){var c=this;resetData();currentRecord=a;c.setTitle(BUTTON_EDIT);var b=c.baseCommonData;Ext.Ajax.request({url:eastcom.baseURL+"/sysmonitor/queryMonitorServer",method:"POST",params:{id:a.get("id")},success:function(e,g){Ext.getCmp("form.editFlag").setValue("1");var n=Ext.JSON.decode(e.responseText).data;var d=n.resConf;var k=d.split(";#;");var h=[];var h=[];for(var j=0;j<k.length-1;j++){var l=k[j].split("&&&");h.push({res_key:l[0],res_name:l[1],res_value:l[2]})}var m=Ext.getCmp("resourceConfGrid").getStore();m.removeAll();m.loadData(h);var f={id:n.id,name:n.name,type:n.type,remark:n.remark};Ext.getCmp("form.id").setValue(f.id);Ext.getCmp("form.name").setValue(f.name);Ext.getCmp("form.type").setValue(f.type);Ext.getCmp("form.remark").setValue(f.remark);Ext.getCmp("form.name").setReadOnly(true);Ext.getCmp("form.id").setReadOnly(true)},failure:function(d,e){}})},initComponent:function(){var a=this;a.items=[a.initAddServerWinComponents()];a.buttons=[{text:BUTTON_OK,handler:function(){var g=Ext.getCmp("addMainForm").getForm();var c=Ext.getCmp("resourceConfGrid").getStore();var e=c.getCount();var b=new Array();for(var f=0;f<e;f++){var j=c.getAt(f);var d=j.data.res_key.replace(""," ")+"&&&"+j.data.res_name.replace(""," ")+"&&&"+j.data.res_value.replace(""," ");b.push(d)}var h=b.toString();if(g.isValid()==true){a.getEl().mask(MSG_DATA_SAVING);Ext.Ajax.request({url:eastcom.baseURL+"/sysmonitor/saveMonitorServer",method:"POST",params:{name:Ext.getCmp("form.name").getValue(),type:Ext.getCmp("form.type").getValue(),remark:Ext.getCmp("form.remark").getValue(),editFlag:Ext.getCmp("form.editFlag").getValue(),id:Ext.getCmp("form.id").getValue(),confRes:b},success:function(l,m){var i=Ext.JSON.decode(l.responseText);if(i.success=="true"){var n={id:i.data.id,name:i.data.name,type:Ext.getCmp("form.type").getRawValue(),remark:i.data.remark};if(currentRecord){currentRecord.set("id",n.id);currentRecord.set("name",n.name);currentRecord.set("type",Ext.getCmp("form.type").getRawValue());currentRecord.set("remark",n.remark)}else{var k=Ext.create("SysMonitorNServer",n);Ext.getCmp("sysMonitorNServerGrid").getStore().insert(0,k)}Ext.Msg.show({title:MSG_SUCCESS,msg:i.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{Ext.Msg.show({title:MSG_FAILURE,msg:i.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}a.getEl().unmask();a.close()},failure:function(k,l){var i=Ext.JSON.decode(k.responseText);Ext.Msg.show({title:MSG_FAILURE,msg:i.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}})}else{Ext.Msg.show({title:MSG_TITLE,msg:MSG_ALL_CONDITIONS,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}},{text:BUTTON_CANCEL,handler:function(){Ext.getCmp("addServerWin").close()}}];this.callParent()}});