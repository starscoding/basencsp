Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.components",eastcom.baseURL+"/static/commonjs/components");Ext.Loader.setPath("Ext.monitor","../../scripts/sysmonitor/components");Ext.require(["Ext.grid.*","Ext.data.*","Ext.ux.RowExpander","Ext.view.View","Ext.ux.DataView.DragSelector","Ext.ux.DataView.LabelEditor","Ext.components.BaseDataComboBox","Ext.components.DateTimeField","Ext.monitor.addIndicatorWin"]);eastcom.modules.sysMonitorIndicator=(function(){var i=null;var d={};Ext.define("SysMonitorTarget",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"type",type:"string"},{name:"subType",type:"string"},{name:"operator",type:"string"},{name:"thresholdRef1",type:"string"},{name:"thresholdRef2",type:"string"},{name:"thresholdRef3",type:"string"},{name:"thresholdRef4",type:"string"},{name:"remark",type:"string"}]});var e=Ext.create("Ext.data.Store",{id:"monitorTStore",model:"SysMonitorTarget",pageSize:eastcom.pageSize,autoLoad:true,proxy:{type:"ajax",url:eastcom.baseURL+"/sysmonitor/MonitorIndicatorList",reader:{type:"json",idProperty:"oid",root:"data.elements",totalProperty:"data.total"},actionMethods:{read:"POST"},timeout:180000}});var g=Ext.create("Ext.Action",{icon:"../../static/images/common/icons/new.png",id:"addAction",text:BUTTON_ADD,handler:function(l,k){if(Ext.getCmp("addIndicatorWin")==null){Ext.create("Ext.monitor.addIndicatorWin",{baseCommonData:d}).show()}else{Ext.Msg.show({title:MSG_TITLE,msg:MONITOR_EDITWIN_EXSIST_MSG,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}});var b=Ext.create("Ext.Action",{icon:"../../static/images/common/icons/edit.png",text:BUTTON_EDIT,hidden:eastcom.isPermitted("sysNotificationmng","edit"),disabled:true,handler:function(n,m){var l=Ext.getCmp("sysMonitorTargetGrid").getSelectionModel().getSelection();if(l.length>1){Ext.Msg.show({title:MSG_TITLE,msg:MONITOR_MUTIL_ERR_MSG,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(Ext.getCmp("addIndicatorWin")==null){var k=Ext.create("Ext.monitor.addIndicatorWin",{baseCommonData:d});k.show(undefined,function(){k.loadServer(l[0])})}else{Ext.Msg.show({title:MSG_TITLE,msg:NOTIFY_CALCEL_OPT,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(p){if(p=="yes"){Ext.getCmp("addIndicatorWin").close();var o=Ext.create("Ext.monitor.addIndicatorWin",{baseCommonData:d});o.show(undefined,function(){o.loadServer(l[0])})}}})}}}});var f=Ext.create("Ext.Action",{icon:"../../static/images/common/icons/delete.png",text:BUTTON_DELETE,disabled:true,handler:function(o,n){var k=Ext.getCmp("sysMonitorTargetGrid").getSelectionModel().getSelection();var m=k[0].get("id");for(var l=1;l<k.length;l++){m=m+","+k[l].get("id")}Ext.Msg.show({title:MSG_SURE,msg:DEL_BTN_INFO,buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(p){if(p=="yes"){Ext.Ajax.request({url:eastcom.baseURL+"/sysmonitor/delMonitorIndicator",method:"POST",params:{ids:m},success:function(r,s){var q=Ext.JSON.decode(r.responseText);if(q.success=="true"){e.remove(k);Ext.Msg.show({title:MSG_SUCCESS,msg:q.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{Ext.Msg.show({title:MSG_FAILURE,msg:q.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}},failure:function(r,s){var q=Ext.JSON.decode(r.responseText);Ext.Msg.show({title:MSG_FAILURE,msg:q.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}})}}})}});var c=Ext.create("Ext.selection.CheckboxModel",{});var a=Ext.create("Ext.grid.Panel",{region:"center",tbar:Ext.create("Ext.toolbar.Toolbar",{items:[g,"-",b,"-",f]}),id:"sysMonitorTargetGrid",store:e,height:200,columnLines:true,selModel:c,columns:[{text:MONITOR_INDICATOR_TYPE,dataIndex:"id",sortable:false,hidden:true,align:"center"},{text:MONITOR_INDICATOR_TYPE,width:180,dataIndex:"type",sortable:false,align:"center"},{text:MONITOR_INDICATOR_SUBTYPE,width:180,dataIndex:"subType",sortable:false,align:"center"},{text:MONITOR_OPERATOR,width:180,dataIndex:"operator",sortable:false,align:"center"},{text:THRESHOLD_REF_1,sortable:false,width:180,dataIndex:"thresholdRef1",align:"center"},{text:THRESHOLD_REF_2,sortable:false,width:180,dataIndex:"thresholdRef2",align:"center"},{text:THRESHOLD_REF_3,sortable:false,width:180,dataIndex:"thresholdRef3",align:"center"},{text:MONITOR_REMARK,width:180,dataIndex:"remark",sortable:false,align:"center"}],bbar:Ext.create("Ext.components.BaseCommonPagingToolbar",{store:e,listeners:{change:function(l,k){i=k}}}),animCollapse:false,listeners:{selectionchange:{fn:function(m,l,k){if(l.length>0&&l[0].get("id")&&l[0].get("id").length){if(b.isDisabled()){b.setDisabled(false)}if(f.isDisabled()){f.setDisabled(false)}}else{if(b.isDisabled()==false){b.setDisabled(true)}if(f.isDisabled()==false){f.setDisabled(true)}}}}},renderTo:Ext.getBody()});function h(){var k=e.proxy;var l={subType:Ext.getCmp("query.subType").getValue()};k.extraParams=l;e.loadPage(1,{start:0,limit:eastcom.pageSize,callback:function(){currentParam=l}})}function j(){Ext.create("Ext.Viewport",{layout:{type:"border",padding:5},items:[{region:"north",padding:"0 0 5 0",xtype:"form",bodyPadding:10,items:[{xtype:"fieldcontainer",labelWidth:80,labelAlign:"right",layout:"hbox",items:[Ext.create("Ext.components.BaseDataComboBox",{parentName:"indicatorType",id:"query.subType",name:"subType",fieldLabel:MONITOR_INDICATOR_TYPE,allFlag:false,emptyText:MSG_CHOOSE_ONE,labelAlign:"right",anchor:"95%",value:""}),{xtype:"button",style:"margin-left:20px",formBind:true,iconCls:"icon-search",width:70,text:BUTTON_SEARCH,handler:h},{xtype:"button",style:"margin-left:20px",formBind:true,iconCls:"icon-refresh",width:70,text:BUTTON_RESET,handler:function(){Ext.getCmp("query.subType").setValue("")}}]}]},a]})}return{initComponent:j}})();