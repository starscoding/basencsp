Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.components",eastcom.baseURL+"/static/commonjs/components");Ext.Loader.setPath("Ext.monitor","../../scripts/sysmonitor/components");Ext.require(["Ext.grid.*","Ext.data.*","Ext.ux.RowExpander","Ext.view.View","Ext.ux.DataView.DragSelector","Ext.ux.DataView.LabelEditor","Ext.components.BaseDataComboBox","Ext.components.DateTimeField","Ext.monitor.addServerWin","Ext.monitor.resourceConfDetailWin"]);eastcom.modules.sysMonitorServer=(function(){var j=null;var c={};Ext.define("SysMonitorNServer",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"type",type:"string"},{name:"remark",type:"string"}]});var h=Ext.create("Ext.data.Store",{id:"monitorNStore",model:"SysMonitorNServer",pageSize:eastcom.pageSize,autoLoad:true,proxy:{type:"ajax",url:eastcom.baseURL+"/sysmonitor/MonitorServerList",reader:{type:"json",idProperty:"oid",root:"data.elements",totalProperty:"data.total"},actionMethods:{read:"POST"},timeout:180000}});var g=Ext.create("Ext.Action",{icon:"../../static/images/common/icons/new.png",id:"addAction",text:BUTTON_ADD,handler:function(n,m){if(Ext.getCmp("addServerWin")==null){Ext.create("Ext.monitor.addServerWin",{baseCommonData:c}).show()}else{Ext.Msg.show({title:MSG_TITLE,msg:MONITOR_EDITWIN_EXSIST_MSG,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}}});var a=Ext.create("Ext.Action",{icon:"../../static/images/common/icons/edit.png",text:BUTTON_EDIT,hidden:eastcom.isPermitted("sysNotificationmng","edit"),disabled:true,handler:function(p,o){var n=Ext.getCmp("sysMonitorNServerGrid").getSelectionModel().getSelection();if(n.length>1){Ext.Msg.show({title:MSG_TITLE,msg:MONITOR_MUTIL_ERR_MSG,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{if(Ext.getCmp("addServerWin")==null){var m=Ext.create("Ext.monitor.addServerWin",{baseCommonData:c});m.show(undefined,function(){m.loadServer(n[0])})}else{Ext.Msg.show({title:MSG_TITLE,msg:NOTIFY_CALCEL_OPT,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(r){if(r=="yes"){Ext.getCmp("addServerWin").close();var q=Ext.create("Ext.monitor.addServerWin",{baseCommonData:c});q.show(undefined,function(){q.loadServer(n[0])})}}})}}}});var f=Ext.create("Ext.Action",{icon:"../../static/images/common/icons/delete.png",text:BUTTON_DELETE,disabled:true,handler:function(q,p){var m=Ext.getCmp("sysMonitorNServerGrid").getSelectionModel().getSelection();var o=m[0].get("id");for(var n=1;n<m.length;n++){o=o+","+m[n].get("id")}Ext.Msg.show({title:MSG_SURE,msg:DEL_BTN_INFO,buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(r){if(r=="yes"){Ext.Ajax.request({url:eastcom.baseURL+"/sysmonitor/delMonitorServer",method:"POST",params:{ids:o},success:function(t,u){var s=Ext.JSON.decode(t.responseText);if(s.success=="true"){h.remove(m);Ext.Msg.show({title:MSG_SUCCESS,msg:s.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}else{Ext.Msg.show({title:MSG_FAILURE,msg:s.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}},failure:function(t,u){var s=Ext.JSON.decode(t.responseText);Ext.Msg.show({title:MSG_FAILURE,msg:s.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}})}}})}});var b=Ext.create("Ext.selection.CheckboxModel",{});var k=Ext.create("Ext.grid.Panel",{region:"center",tbar:Ext.create("Ext.toolbar.Toolbar",{items:[g,"-",a,"-",f]}),id:"sysMonitorNServerGrid",store:h,height:200,columnLines:true,selModel:b,columns:[{text:MONITOR_NAME,flex:1,sortable:false,dataIndex:"id",hidden:true},{text:MONITOR_NAME,flex:1,sortable:false,dataIndex:"name",width:200,renderer:e},{text:MONITOR_USE_KIND,width:300,dataIndex:"type",sortable:false,align:"center"},{text:MONITOR_REMARK,width:300,dataIndex:"remark",sortable:false,align:"center"}],bbar:Ext.create("Ext.components.BaseCommonPagingToolbar",{store:h,listeners:{change:function(n,m){j=m}}}),animCollapse:false,listeners:{selectionchange:{fn:function(o,n,m){if(n.length>0&&n[0].get("id")&&n[0].get("id").length){if(a.isDisabled()){a.setDisabled(false)}if(f.isDisabled()){f.setDisabled(false)}}else{if(a.isDisabled()==false){a.setDisabled(true)}if(f.isDisabled()==false){f.setDisabled(true)}}}}},renderTo:Ext.getBody()});function i(){var m=h.proxy;var n={name:Ext.getCmp("query.name").getValue(),type:Ext.getCmp("query.type").getValue()};m.extraParams=n;h.loadPage(1,{start:0,limit:eastcom.pageSize,callback:function(){currentParam=n}})}function e(o,n,m,q){var p=m.get("id");return'<a style="cursor: pointer;color:blue;text-decoration:underline;" onclick="resourceConfDetail(\''+p+"')\">"+o+"</a>"}function d(o){var n=Ext.getCmp("resourceConfDetailWin");if(n){n.close()}var m=Ext.create("Ext.monitor.resourceConfDetailWin");m.show(undefined,function(){m.load({resourceId:o})})}function l(){Ext.create("Ext.Viewport",{layout:{type:"border",padding:5},items:[{region:"north",padding:"0 0 5 0",xtype:"form",bodyPadding:10,items:[{xtype:"fieldcontainer",labelWidth:80,labelAlign:"right",layout:"hbox",items:[Ext.create("Ext.components.BaseDataComboBox",{parentName:"monitorUseKind",id:"query.type",name:"type",fieldLabel:MONITOR_USE_KIND,allFlag:false,labelAlign:"right",emptyText:MSG_CHOOSE_ONE,anchor:"95%",value:""}),{xtype:"textfield",id:"query.name",name:"name",fieldLabel:MONITOR_NAME,editable:false,labelAlign:"right",anchor:"95%"},{xtype:"button",style:"margin-left:20px",formBind:true,iconCls:"icon-search",width:70,text:BUTTON_SEARCH,handler:i},{xtype:"button",style:"margin-left:20px",formBind:true,iconCls:"icon-refresh",width:70,text:BUTTON_RESET,handler:function(){Ext.getCmp("query.name").setValue("");Ext.getCmp("query.type").setValue("")}}]}]},k]})}return{initComponent:l,initResourceConfDetail:d}})();