Ext.define("FV.controller.Feeds",{extend:"Ext.app.Controller",stores:["Feeds","Articles"],models:["Feed"],refs:[{ref:"feedList",selector:"feedlist"},{ref:"feedData",selector:"feedlist dataview"},{ref:"feedShow",selector:"feedshow"},{ref:"articleGrid",selector:"articlegrid"},{ref:"articlePreview",selector:"articlepreview"},{ref:"label",selector:"articlegrid label"}],init:function(){this.control({"feedlist dataview":{selectionchange:this.loadFeed}})},onLaunch:function(){var a=this.getFeedData(),b=this.getFeedsStore();a.bindStore(b);a.getSelectionModel().select(b.getAt(0))},loadFeed:function(e,d){var h=this;var a=h.getArticleGrid(),i=h.getFeedShow(),g=h.getArticlePreview();store=h.getArticlesStore(),feed=d[0];var c=new Ext.LoadMask(i,{msg:MSG_DATA_OPTING});if(feed){h.getFeedShow().setTitle(feed.get("name"));var b=g.down("button[action=deletekey]");feed.get("canDelete")?b.enable():b.disable();feed.get("type")=="Hash"&&feed.get("regexp").indexOf("*")==-1?g.hide():g.show();a.enable();var f=function(j,k){c.show();store.load({params:{type:j,regexp:k},callback:function(m,l,o){var n=m.length;if(n==0){g.hide();g.update(null)}c.hide()}})};if(feed.get("key")=="CUSTOM_FUZZY"){store.removeAll();a.switchCustom(true)}else{a.switchCustom(false);f(feed.get("type"),feed.get("regexp"))}}},addFeed:function(){this.getFeedWindow().show()},removeFeed:function(){this.getFeedsStore().remove(this.getFeedData().getSelectionModel().getSelection()[0])},createFeed:function(){var e=this.getFeedWindow(),b=this.getFeedForm(),d=this.getFeedCombo(),a=this.getFeedsStore(),c=this.getFeedModel().create({name:d.getDisplayValue(),url:d.getValue()});b.setLoading({msg:"Validating feed..."})}});