Eastcom.modules.usersList=(function(){var b=4;var e=function(){return $("#south table td div.usersList")};var d=null;var g=function(k,m){var l=e();i(k);l.bind("click",function(){f()});if(typeof(m)==="string"){try{m=parseInt(m)}catch(n){m=0}}else{if(typeof(m)!="number"){m=0}}setTimeout(function(){c(m)},5*1000)};var c=function(k){a(function(l){i(l)},{onlyQueryNum:true});if(k>0){setTimeout(function(){c(k)},k*1000)}};var j=function(p){var o=$('<div class="onlineusersBox"></div>');var l=[];var k=Math.ceil(p.length/b);for(var m=0;m<k;m++){var n=$('<div class="usersLine"></div>');l.push(n)}$.each(p,function(u,t){var s=Math.floor(u/b);var v=t.department;if(v&&v.length&&v!="null"){if(v.length>10){var z=v+"";v=v.substring(0,7)+"...";v='<a title="'+z+'" >'+v+"</a>"}}else{v="无"}var y=$('<div class="onlineUserLabel"></div>');var w=$('<a class="onlineUserHead onlineUserHead_'+t.sex+'"></a>');var x=$('<a class="nameLabel">'+t.nameCn+"</a>");var r='<table class="userDetailDom" cellspacing = "0">';r+="<tr>";r+='<td valign="top" style="width:55px;">用户名:</td>';r+="<td>"+t.nameCn+"</td>";r+="</tr>";r+="<tr>";r+='<td valign="top">所属部门:</td>';r+='<td class="rightTd">'+v+"</td>";r+="</tr>";r+="<tr>";r+="<td>登陆时间:</td>";r+="<td>"+t.loginTime+"</td>";r+="</tr>";r+="<tr>";r+="<td>登陆IP:</td>";r+="<td>"+t.clientIp+"</td>";r+="</tr>";r+="</table>";var q=$(r);y.append(w);y.append(x);y.append(q);y.hover(function(){y.stop(true,false);x.hide();y.addClass("active");w.css({"margin-left":"0px","margin-top":"10px"});y.animate({width:220,height:100},100,function(){q.show()})},function(){y.stop(true,false);q.hide();y.animate({width:70},100,function(){x.show();y.removeClass("active");w.css({"margin-left":"10px","margin-top":"0px"})})});l[s].append(y)});$.each(l,function(r,q){o.append(q)});return o};var f=function(){d=d||new CommonWindow({height:350,width:500,title:ONLINE_USER_TITLE,content:"",animationPosition:e().offset(),closeAction:"hide"});d.show(function(){d.getBody().mask(MSG_DATA_LOADING);a(function(k){h(k);d.getBody().unmask()})})};var a=function(l,k){$.ajax({type:"POST",dataType:"json",data:k,url:Eastcom.baseURL+"/loginExtension/getOnlineUsers",success:function(m){if(m.success="true"){l(m.data)}}})};var i=function(k){var l=e();if(typeof(k)!="undefined"){l[0].innerHTML=Eastcom.sprintf(CURRENT_ONLINE_NUMS,k)}};var h=function(l){i(l.length);var k=j(l);d.updateContent(k)};return{init:g}})();