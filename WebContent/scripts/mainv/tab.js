define(["./utils","./tabitem","./menuitem","./config"],function(o,k,r,p){var l=true,d,i=10,h=[],q=null,j=null,b={},c={getTabsRow:function(){return $("#tabs-row")},getTabsCnt:function(){return $("#tabs")},getIframeCnt:function(){return $("#tabs-iframe-cnt")},getLogo:function(){return $("#logo")}},g={id:"index",image:null,isShowDesktop:"0",isWebpage:"1",kind:"0",location:"/pages/globalview/leaderShipViewNew.jsp",name:"index",nameCn:"首页",order:0,pid:"",status:"1",childs:[]},n;k.setCallback("show",function(s){j=s});var a=function(s){var u=/^(http:\/\/)/i,t=/^(https:\/\/)/i;return u.exec(s)||t.exec(s)};var e=function(s){return a(s)?s:(eastcom.baseURL+s)};var m=function(){var u;for(u=0;u<h.length;u++){var s=h[u];if(s.destroyable()){s.destroy();break}}h.splice(u,1)};b.close=function(s){if(!s||!s.length){s=j._menu.id}$.each(h,function(v,u){if(u.matchId(s)){u.destroy();h.splice(v,1);return false}})};b.getCurrent=function(){return j};b.getTab=function(s){var t;$.each(h,function(v,u){if(u.matchId(s)){t=u;return false}});return t};b.add=function(z){var u=z.menu,C=z.forceRefresh,A=z.closable,t=false;u.location=e(u.location);if(u.location.indexOf("target=newWindow")!=-1){window.open(u.location);return}if(u.location.indexOf("target=self")!=-1){window.location.href=u.location;return}var y=getBaseURL();if(u.location.indexOf("project=ecip")!=-1){var x;if(u.location.indexOf("ecipVisitor?path=")==-1){x=u.location.substring(y.length,u.location.length);u.location=y+"/ecipVisitor?path="+x}}var v=true;if(p.theme=="blue"&&p.showTabBar==true){if(z.menu.id=="index"){c.getTabsRow().addClass("hide");v=false}else{c.getTabsRow().removeClass("hide");v=true}}else{v=false}$("#fakeiframe").remove();var w=c.getTabsCnt();var B=c.getIframeCnt();if(l){$.each(h,function(E,D){if(D.matchId(u.id)){if(D.isDestroyed()){h.splice(E,1)}else{t=true;if(C){D.setLocation(u.location)}D.show();j=D}return false}});if(!t){if(v){if(!isAdd(u)){eastcom.showMsg("danger","空间不足，请关闭部分Tab页");return}}var s=k.create(u,{previousTab:j,closable:A,destroyable:z.destroyable});s.render(w,B);s.show();j=s;h.push(s)}q=u}else{if(h[0]&&h[0].matchId(u.id)){if(C){h[0].setLocation(u.location);q=u}}else{w.empty();if(j){j.destroy()}var s=k.create(u);s.render(w,B);s.show();q=u;j=s;h=[s]}}};var f=function(){c.getLogo().on("click",function(){b.add({menu:d,destroyable:false})})};b.init=function(){i=p.tabMaxNum*1;if(p.showTabBar==true){c.getTabsRow().removeClass("hide")}f();g=$.extend(g,{location:p.defaultPageLocation,nameCn:p.defaultPageName});d=r.create(g);if(!(p.menu&&p.menu.length)){this.add({menu:d,destroyable:false})}$(".close-btn").hide()};return b});function getBaseURL(){var d="";var e=document.getElementsByTagName("head")[0];var a=e.childNodes;for(var c=0;c<a.length;++c){var f=a.item(c).src;if(f){var b=f.indexOf("/scripts/mainv/main.js");if(b>=0){d=f.substring(0,b)}}}return d};