define(["./utils","./menuitem","./tab","./tabitem","./config","text!./template/lefttree.html"],function(j,h,b,a,c,k){var m={getCnt:function(){return $("#content")},getUl:function(){return $("#left-menu-list")},getMenuPanel:function(){return $("#content .left-tree")},getCollapse:function(){return $("#content .left-tree .collapse_cnt")},getIcon:function(){return $("#content .left-tree .collapse_cnt .collapse-ico")},getIframeCnt:function(){return $("#tabs-iframe-cnt")}},f={top:$(k).find("#left-tree-top-tpl").html(),item:$(k).find("#left-tree-item-tpl").html()},d=true;var e=function(n){$.ajax({type:"POST",url:eastcom.baseURL+"/loginExtension/getCurrentUserTreeResources",data:{rootMenuName:c.leftTreeParent,controlStatus:true},dataType:"json",success:function(p){if(j.validateAjaxRs(p,"左侧菜单加载失败")){if(p.data&&p.data.length){var o=h.create(p.data[0]);n(o)}}}})};var g=function(p){if(!p||!p.childs.length){return}var o=m.getUl().empty();var n=function(q,r){$.each(q,function(s,u){var t;if(r>1){return}if(r==0){t=j.getTplDom(f.top,{nameCn:u.nameCn,image:eastcom.baseURL+"/static/images/common/appicons/"+u.image})}else{if(u.isMenu()){t=j.getTplDom(f.item,{id:u.getId(),disabledclass:u.isDisabled()?"disabled":"",showHot:u.isHot()?"":"hide",showNew:u.isNew()?"":"hide",nameCn:u.nameCn});t.css({"margin-left":(20*(r-1))+"px"})}}if(t){o.append(t)}if(u.hasChildNodes()){n(u.childs,r+1)}})};n(p.childs,0);a.updateMinHeight(m.getMenuPanel().outerHeight());m.getIcon().removeClass("hide")};var i=function(){var o=m.getUl(),n=m.getMenuPanel(),q=m.getCollapse(),p=m.getIframeCnt();o.on("click","li a",function(){var s=$(this).attr("id"),r=h.findMenu(s);if(r.isEnable()){b.add({menu:r})}});q.on("click",l)};var l=function(p,o){if(p!=undefined){if(d==p){return}}var s=240,t=10,r,n=m.getMenuPanel(),q=m.getIframeCnt();if(d){n.addClass("left-tree-moving");r=function(){if(s>t){n.width(s);q.css({"margin-left":s+10});s-=10;setTimeout(r,10)}else{d=false;n.removeClass("left-tree-moving");n.addClass("left-tree-min");if(o&&$.type(o)=="function"){o()}}}}else{n.removeClass("left-tree-min");r=function(){if(t<s){n.width(t);q.css({"margin-left":t+10});t+=10;setTimeout(r,10)}else{d=true;n.removeClass("left-tree-moving");if(o&&$.type(o)=="function"){o()}}}}r()};return{init:function(){if(j.isNotBlank(c.leftTreeParent)){m.getCnt().removeClass("hide-left-tree");i();e(g)}},tonggle:l}});