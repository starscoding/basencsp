define(["./utils"],function(i){var d="1",f={},k={getModal:function(){return $("#userinfo")},getUserName:function(){return $("#user-info-form input[name=userName]")},getUserFullName:function(){return $("#user-info-form input[name=userFullName]")},getFixNo:function(){return $("#user-info-form input[name=fixedNo]")},getMobileNo:function(){return $("#user-info-form input[name=mobileNo]")},getEmail:function(){return $("#user-info-form input[name=email]")},getOldPsd:function(){return $("#psd-form input[name=oldPsd]")},getNewPsd:function(){return $("#psd-form input[name=newPsd]")},getRetypePsd:function(){return $("#psd-form input[name=retypeNewPsd]")},getUserinfoInputs:function(){return $("#user-info-form input")},getPsdInputs:function(){return $("#psd-form input")},getSubmitBtn:function(){return $("#submit-userinfo")},getAllTabLi:function(){return $("#info-content .nav li")},getMask:function(){return $("#userinfo-mask")},getUserExtInfoInputs:function(){return $("#ext-form input")},getExtVal:function(){return $("#ext-form input.form-control")}};var g=function(l,m){l.blur(m);l.change(m);l.keyup(m);l.on("dovalidate",m)};var c=function(n,m){var l=function(){var p=$(this),q=p.val(),o=p.parent();if(m(q)){o.removeClass("has-error")}else{o.addClass("has-error")}};g(n,l)};var h=function(m){var l=true;$.each(m,function(o,n){var p=$(n);p.trigger("dovalidate");if(p.parent().hasClass("has-error")){l=false}});return l};var b=function(){var l,n,m;if(h(k.getUserinfoInputs())){l=k.getMobileNo().val();n=k.getFixNo().val();m=k.getEmail().val();j(true);$.ajax({type:"POST",dataType:"json",data:{mobile:l,tel:n,email:m},url:eastcom.baseURL+"/sysmng/security/updateBasicInfo",success:function(o){i.showMsg("success",o.msg);j(false)},failure:function(){i.showMsg("danger","保存失败");j(false)}})}};var a=function(){var n=$("#extUserId").val();var l=$("#userExtTable").val();if(h(k.getUserExtInfoInputs())){var m="";$("#ext-form input.form-control").each(function(o,p){var q=$(this).attr("name");var r=q+":"+$("#"+q).val();m+=r+";"});m=m.substring(0,m.length-1);j(true);$.ajax({type:"POST",dataType:"json",data:{extUserId:n,userExtTable:l,extVal:m},url:eastcom.baseURL+"/sysmng/security/updateExtInfo",success:function(o){i.showMsg("success",o.msg);j(false)},failure:function(){i.showMsg("danger","保存失败");j(false)}})}};var e=function(){var l,m;if(!h(k.getPsdInputs())){var n=validatePwd_util(k.getUserName().attr("value"),k.getNewPsd().val(),k.getUserFullName().attr("value"));if(n){alert(n)}return}else{l=k.getOldPsd().val();m=k.getNewPsd().val();j(true);$.ajax({type:"POST",dataType:"json",data:{sendOldPassword:l,password:m},url:eastcom.baseURL+"/sysmng/security/extension/updatePassword",success:function(o){if(o.success=="true"){window.location.href=eastcom.baseURL+"/logout"}else{i.showMsg("danger",o.msg)}j(false)},failure:function(){i.showMsg("danger","保存失败");j(false)}})}};var j=function(l){if(l){k.getMask().removeClass("hide")}else{k.getMask().addClass("hide")}};f.toggle=function(){k.getModal().modal("toggle")};f.init=function(){c(k.getFixNo(),function(l){if(l&&l.length){return new RegExp("^\\(?\\d{3,4}[-\\)]?\\d{7,8}$").test(l)}else{return true}});c(k.getMobileNo(),function(l){if(l&&l.length){return new RegExp("^0?\\d{11}$").test(l)}else{return true}});c(k.getEmail(),function(l){if(l&&l.length){return new RegExp("^[a-zA-Z0-9_+.-]+@([a-zA-Z0-9-]+.)+[a-zA-Z0-9]{2,4}$").test(l)}else{return true}});c(k.getOldPsd(),function(l){return !!(l&&l.length)});c(k.getNewPsd(),function(n){var l=false;var m=validatePwd_util(k.getUserName().attr("value"),n,k.getUserFullName().attr("value"));if(m){l=false}else{l=true}return l});c(k.getRetypePsd(),function(m){var l=false;if(m&&m.length>=8){l=(m==k.getNewPsd().val())}return l});c(k.getExtVal(),function(l){if(l&&l.length){return true}else{return false}});k.getAllTabLi().on("click",function(){var m=$(this).attr("name"),l=m.substr(m.length-1,1);if(l=="1"){k.getSubmitBtn().addClass("hide")}else{k.getSubmitBtn().removeClass("hide")}d=l});k.getSubmitBtn().on("click",function(){if(d=="2"){b()}else{if(d=="3"){e()}else{if(d=="4"){a()}}}})};return f});