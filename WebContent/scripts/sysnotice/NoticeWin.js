var NoticeWin=function(d){var s=this;var h=[];var q=0;var a=null;var j={height:300,width:450,interval:60000,title:NOTIFY_WIN_TITLE};var p=function(){d=d?$.extend(j,d):j;d.content='<div id="nocbox_tips"></div><div id="new_noc_list"></div>';d.buttons=[{text:NOTIFY_TOTAL_READ,handler:function(){var u=l();i(u)}},{text:NOTIFY_ALL_MSG,handler:function(){Eastcom.createTab("show_remind_histroy",NOTIFY_ALL_MSG,"personal_history_noc","/pages/notify/userNotifications.jsp",NOTIFY_ALL_MSG,true,true,false)}}];var t=$("#new_noc_list > div.noc_iterm > ul.noc_iterm_data > li");t.live("mouseenter",function(){$(this).addClass("noc_iterm_hover")});t.live("mouseleave",function(){$(this).removeClass("noc_iterm_hover")});$("#new_noc_list > div.noc_iterm > ul.noc_iterm_data > li").live("click",function(){var u=$(this).attr("sms_id");i($(this));var v="/pages/notify/notificationDetail.jsp?id="+u;Eastcom.createTab("show_noc_detail_info",NOTIFY_DETAIL,"noc_detail_info",v,NOTIFY_DETAIL,true,true,true)});$("#new_noc_list > div.noc_iterm > .noc_iterm_title > .noc_iterm_cancel").live("click",function(){var v=$(this).attr("type_id");var u=l(v);i(u)})};var i=function(v,w){if(v&&v.length){var u=[];$.each(v,function(x,y){u.push($(y).attr("sms_id"))});var t=new Date().format("yyyy-MM-dd hh:mm:ss");jQuery.ajax({type:"POST",async:true,dataType:"json",url:Eastcom.baseURL+"/sysmng/notificationLog/saveNocLog",data:{viewTime:t,ids:u.join(",")},success:function(x){if(x&&x.data==true){$.each(v,function(y,z){$(z).remove()});q-=v.length;g();b();if(typeof(w)=="function"){w()}}},error:function(y,A,z){var x=Eastcom.sprintf(NOTIFY_OPT_FAILED,A);alert(x)}})}};var o=function(){return $("#nocbox_tips")};var n=function(){return $("#new_noc_list")};var r=function(){return $("#south table td #nocbox")};var b=function(){if(q>0){return false}n().hide();var t=Eastcom.sprintf(NOTIFY_CLOSE_AFTER,"<span class='red'>"+3+"</span>");o().html("<br><br><br><h2>"+NOTIFY_NO_NEW_MSG+"</h2><br />"+t).show();if(a){window.clearInterval(a)}var u=function(){var w=o().children("span.red");var v=Number(w.text());if(v>1){v-=1;w.text(v)}else{s.hide();window.clearInterval(a)}};a=window.setInterval(u,1000)};var e=function(){if(h.length){s.setTitle(d.title+"   "+eastcom.sprintf(NOTIFY_YOU_HAVE_MSGS,'<a class="noc_iterm_num">'+h.length+"</a>"))}else{s.setTitle(d.title)}};var l=function(t){idsobj=null;if(t&&t.length){idsobj=n().find(".noc_iterm_"+t+" .noc_iterm_data > li")}else{idsobj=n().find(".noc_iterm_data > li")}return idsobj};var g=function(){var t=$("#south table td div.numinfo");t.find("span").html(q).css("color","red");if(q){r().css("background-image",'url("'+Eastcom.baseURL+'/static/images/themes/blue/main/nobox_.gif")');t.show()}else{r().css("background-image",'url("'+Eastcom.baseURL+'/static/images/themes/blue/main/nobox.png")');t.hide()}};var f=function(){var u=h;var t="";n().empty();u.sort(function(w,v){if(w.effectStartTime>v.effectStartTime){return -1}if(w.effectStartTime<v.effectStartTime){return 1}return 0});jQuery.each(u,function(v,x){if(x.id==""){return false}var w=x.title;if(n().find(".noc_iterm_"+x.type).size()!=0){t='<li id="noc_li_'+x.id+'" sms_id="'+x.id+'" type_id="'+x.type+'" title="'+w+'">';t+='<div class="noc_iterm_time">'+NOTIFY_ABOUT+x.sendTime+NOTIFY_AGO+'</div><div class="noc_iterm_content">'+w+"</div>";t+="</li>";$(".noc_iterm_"+x.type+" >ul").append(t)}else{t='<div class="noc_iterm noc_iterm_'+x.type+'">';t+='<div class="noc_iterm_title"><span class="noc_iterm_cancel" type_id="'+x.type+'" title="'+NOTIFY_ALL_READ+'"></span>'+x.typeName+"</div>";t+='<ul class="noc_iterm_data">';t+='<li id="noc_li_'+x.id+'" sms_id="'+x.id+'" type_id="'+x.type+'" title="'+w+'">';t+='<div class="noc_iterm_time">'+NOTIFY_ABOUT+x.sendTime+NOTIFY_AGO+'</div><div class="noc_iterm_content">'+w+"</div>";t+="</li>";t+="</ul>";t+="</div>";n().append(t)}});n().show()};var c=function(){jQuery.ajax({type:"POST",async:true,dataType:"json",url:Eastcom.baseURL+"/sysmng/notification/initRelationAndGetUserNocInfo",success:function(t){o().empty().hide();if(t.success=="true"){var u=t.data;h=u;if(u.length){if(!s.isShow()){s.show(null,true)}f()}else{b()}q=u.length;g(u.length);e()}},error:function(t,v,u){o().html('<div class="error">'+NOTIFY_LOAD_FAILED+"("+t.status+")ï¼š"+v+"</div>").show()}})};p();CommonWindow.call(s,d);var k=function(){c();window.setInterval(c,d.interval)};var m=s.show;s.show=function(v,t){var u=function(){if(!t){c()}if(typeof(v)=="function"){v()}};m(u)};this.intervalLoad=k};