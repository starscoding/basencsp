Ext.ns("ncsp.portal.managerPortal");Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux",extDir+"/ux");Ext.Loader.setPath("Ext.components","../../static/commonjs/components/");Ext.require(["Ext.grid.*","Ext.data.*","Ext.util.*","Ext.toolbar.Paging","Ext.ModelManager","Ext.tip.QuickTipManager","Ext.components.BaseDataComboBox","Ext.components.BaseCommonPagingToolbar","Ext.components.DateTimeField","Ext.selection.CheckboxModel","Ext.toolbar.Paging","Ext.ux.RowExpander"]);var addWin;var editWin;(function(){var i=true;var f=Ext.create("Ext.Action",{iconCls:"icon-add",text:"新增",handler:function(t,s){if(addWin=="undefined"||addWin==null){addWin=Ext.create("Ext.window.Window",{title:"添加工具",height:350,width:400,closeAction:"hide",modal:true,resizable:false,items:[m]}).show()}else{addWin.show()}}});var k={toolName:""};function c(){var s=Ext.getCmp("toolName").getValue();k.toolName=encodeURI(s)}var b=Ext.create("Ext.Action",{iconCls:"icon-edit",disabled:true,text:"编辑",handler:function(u,t){var v=n.getSelectionModel().getSelection();if(v.length>1){Ext.Msg.alert("提示","一次只能修改一项");return}else{Ext.getCmp("editName").setValue(v[0].data.name);Ext.getCmp("editDesc").setValue(v[0].data.desc);Ext.getCmp("editId").setValue(v[0].data.id);if(v[0].data.category==0){Ext.getCmp("editCategory").setValue("修改工具类")}else{if(v[0].data.category==1){Ext.getCmp("editCategory").setValue("维修工具类")}else{if(v[0].data.category==2){Ext.getCmp("editCategory").setValue("添加哦能够积")}}}Ext.getCmp("editDefaultHeight").setValue(v[0].data.defaultHeight);Ext.getCmp("editExtImplClassName").setValue(v[0].data.classUrl);Ext.getCmp("editClassRoute").setValue(v[0].data.className);var s=Ext.getCmp("editScroll");if(v[0].data.scrolling==0){Ext.getCmp("srcollGroup1").checked}else{if(v[0].data.scrolling==1){Ext.getCmp("srcollGroup2").checked}}}if(editWin=="undefined"||editWin==null){editWin=Ext.create("Ext.window.Window",{title:"编辑",height:350,width:400,closeAction:"hide",modal:true,resizable:false,items:[d]}).show()}else{editWin.show()}}});var o=Ext.create("Ext.Action",{iconCls:"icon-remove",disabled:true,text:"删除",handler:function(v,u){var w=n.getSelectionModel().getSelection();var t="";for(var s=0;s<w.length;s++){t=w[s].get("id")+";"+t}Ext.Ajax.request({url:eastcom.baseURL+"/portal/deletePortalFunction",method:"post",timeout:60000,params:{id:t},success:function(y){var x=Ext.JSON.decode(y.responseText);if(x.success=="true"){Ext.Msg.show({title:"成功",msg:x.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});for(var z=0;z<w.length;z++){a.remove(w[z])}}else{Ext.Msg.show({title:"失败",msg:x.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}},failure:function(x,y){Ext.Msg.show({title:"失败",msg:"操作失败",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}})}});var l={starttime:"",endtime:""};var g=Ext.create("Ext.components.DateTimeField",{fieldLabel:"创建时间",labelAlign:"left",id:"queryStarttime",width:600,format:"y-m-d",autoShow:true,wordWrap:true,endDateField:"queryEndtime"});var r=Ext.create("Ext.components.DateTimeField",{fieldLabel:"结束时间",labelAlign:"left",id:"queryEndtime",format:"y-m-d",width:600,autoShow:true,wordWrap:true,startDateField:"queryStarttime"});var e=Ext.create("Ext.form.Panel",{region:"north",height:50,padding:"0 0 5 0",xtype:"form",id:"condtionFormPanel",bodyPadding:10,items:[{xtype:"fieldcontainer",fieldLabel:"工具名称",labelWidth:80,labelAlign:"right",layout:"hbox",items:[{xtype:"textfield",allowBlank:true,id:"toolName",name:"toolName",blankText:"请输入查询的工具名称",width:200},{xtype:"splitter"},{xtype:"button",style:"margin-left:20px",formBind:true,iconCls:"icon-search",width:60,text:"查&nbsp;&nbsp;询",handler:function(){c();var s=a.proxy;s.actionMethods={read:"POST"};s.extraParams={toolName:k.toolName};a.load()}}]}]});var q=Ext.define("Gartor",{extend:"Ext.data.Model",fields:[{name:"id",type:"String"},{name:"name",type:"String"},{name:"category",type:"String"},{name:"createTime",type:"String"},{name:"className",type:"String"},{name:"classUrl",type:"String"},{name:"desc",type:"String"},{name:"imageUrl",type:"String"},{name:"smallImageUrl",type:"String"},{name:"scrolling",type:"String"},{name:"defaultHeight",type:"String"}]});var a=Ext.create("Ext.data.Store",{model:"Gadgets",pageSize:eastcom.pageSize,proxy:{type:"ajax",url:eastcom.baseURL+"/portal/queryPortalPage",actionMethods:{read:"POST"},reader:{type:"json",root:"elements",totalProperty:"total"}}});var p=Ext.create("Ext.selection.CheckboxModel");var n=Ext.create("Ext.grid.Panel",{viewConfig:{id:"gv",trackOver:false,stripeRows:false},fit:true,autoHeight:true,rootVisible:false,columnLines:true,region:"center",enableColumnHide:eastcom.enableColumnHide,columns:[{header:"工具ID",dataIndex:"id",align:"center"},{header:"工具名称",dataIndex:"name",align:"center"},{header:"工具类别",dataIndex:"category",align:"center",renderer:function(s){if(s==0){return"修改工具类"}else{if(s==1){return"维修工具类"}else{if(s==2){return"制造工具类"}}}}},{header:"创建时间",dataIndex:"createTime",width:150,align:"center"},{header:"EXT实现类名称",dataIndex:"className",align:"center",width:200},{header:"描述",dataIndex:"desc",align:"center",minWidth:250},{header:"图片地址",dataIndex:"imageUrl",align:"center"},{header:"小图标地址",dataIndex:"smallImageUrl",align:"center"},{header:"是否滚动",dataIndex:"scrolling",width:60,align:"center",renderer:function(s){if(s==0){return"是"}else{if(s==1){return"否"}}}},{header:"默认高度",dataIndex:"defaultHeight",align:"center"},{header:"类的路径",dataIndex:"classUrl",align:"center"}],dockedItems:[{xtype:"toolbar",items:[f,"-",b,"-",o]}],store:a,selModel:p,columnLines:true,plugins:[{ptype:"rowexpander",rowBodyTpl:['&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../../static/images/portal/{smallImageUrl}"/> <p style="padding-left:45px">',"<b>描述:</b> {desc} <br/>"]}],bbar:Ext.create("Ext.PagingToolbar",{store:a,displayInfo:true,displayMsg:"显示条数{0} - {1}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;总共 {2}条",emptyMsg:"No topics to display"}),listeners:{selectionchange:function(t,s){if(s.length>0){if(s.length==1){b.enable();o.enable()}else{o.enable();b.disable()}}else{b.disable();o.disable()}}}});var j=Ext.create("Ext.data.Store",{fields:["backData","appareData"],data:[{backData:"0",appareData:"修改工具类"},{backData:"1",appareData:"维修工具类"},{backData:"2",appareData:"制造工具类"}]});var h=Ext.create("Ext.data.Store",{fields:["backData","appareData"],data:[{backData:"100",appareData:"100"},{backData:"200",appareData:"200"},{backData:"300",appareData:"300"}]});var m=Ext.create("Ext.form.Panel",{defaultType:"textfield",id:"transFormPanel",bodyPadding:5,defaults:{labelAlign:"right",labelWidth:90,width:350,msgTarget:"side"},items:[{fieldLabel:"工具名",name:"name",id:"addName"},{xtype:"textfield",fieldLabel:"工具类别",name:"category",id:"addCategory"},{fieldLabel:"Ext实现类名称",name:"addExtImplClassName",id:"addExtImplClassName",xtype:"textfield"},{fieldLabel:"类路径",name:"addClassRoute",id:"addClassRoute",xtype:"textfield"},{fieldLabel:"描述",name:"desc",xtype:"textarea",id:"addDesc"},{fieldLabel:"默认高度",name:"defaultHeight",forceSelection:true,xtype:"combo",store:h,queryModel:"local",editable:false,displayField:"appareData",valueField:"backData",id:"addDefaultHeight"},{fieldLabel:"工具图片",xtype:"filefield",id:"addTransFormImage",name:"transFormImage",buttonText:"选择图片"},{fieldLabel:"是否滚动",xtype:"radiogroup",id:"addScrolling",name:"scrolling",vertical:true,items:[{boxLabel:"是",labelAlign:"left",name:"srcoll",inputValue:"1",checked:true},{boxLabel:"否",labelAlign:"left",name:"srcoll",inputValue:"2"}]}],buttons:[{text:"添加",handler:function(){var s=Ext.getCmp("addName").getValue();if(s==null||s==""){Ext.Msg.alert("提示","工具名不能为空");return}var u=Ext.getCmp("addClassRoute").getValue();if(u==null||u==""){Ext.Msg.alert("提示","工具类路径不能为空");return}var y=Ext.getCmp("addExtImplClassName").getValue();if(y==null||y==""){Ext.Msg.alert("提示","Ext实现类名称不能为空");return}var B=Ext.getCmp("addCategory").getValue();if(B==null||B==""){Ext.Msg.alert("提示","工具类别不能为空");return}var v=Ext.getCmp("addDefaultHeight").getValue();if(v==null||v==""){Ext.Msg.alert("提示","默认高度不能为空");return}var w=Ext.getCmp("addScrolling").getValue();if(w==null||w==""){Ext.Msg.alert("提示","是否自动滚动不能为空");return}var x=Ext.getCmp("addTransFormImage").getValue();if(x==null||x==""){Ext.Msg.alert("提示","图片不能为空");return}var z=Ext.getCmp("addDesc").getValue();if(z==null||z==""){Ext.Msg.alert("提示","描述不能为空");return}var A=x.lastIndexOf(".");var t=x.substring(A+1).toLowerCase();if(t!="png"&&t!="jpg"&&t!="jpeg"&&t!="gif"&&t!="bmp"){Ext.Msg.alert("提示","只能上传图片");return}Ext.getCmp("transFormPanel").getForm().submit({url:eastcom.baseURL+"/portal/addPortalFunction",method:"POST",success:function(C,D){addWin.hide();Ext.getCmp("transFormPanel").getForm().reset();Ext.Msg.alert("提示","添加成功");addWin.hide()},failure:function(C,D){addWin.hide();Ext.getCmp("transFormPanel").getForm().reset();Ext.Msg.alert("提示","添加失败");addWin.hide()}})}},{text:"取消",handler:function(){Ext.getCmp("transFormPanel").getForm().reset();addWin.hide()}}]});var d=Ext.create("Ext.form.Panel",{defaultType:"textfield",id:"editFormPanel",bodyPadding:5,defaults:{labelAlign:"right",labelWidth:90,width:350,msgTarget:"side"},items:[{xtype:"hidden",name:"editId",id:"editId"},{fieldLabel:"工具名",name:"editName",id:"editName"},{xtype:"textfield",fieldLabel:"工具类别",name:"editCategory",id:"editCategory"},{fieldLabel:"Ext实现类名称",name:"editExtImplClassName",xtype:"textfield",id:"editExtImplClassName"},{fieldLabel:"类路径",name:"editClassRoute",xtype:"textfield",id:"editClassRoute"},{fieldLabel:"描述",name:"editDesc",xtype:"textarea",id:"editDesc"},{fieldLabel:"描述",name:"editDesc",xtype:"textarea",id:"editDesc"},{fieldLabel:"默认高度",name:"editDefaultHeight",xtype:"combo",store:h,forceSelection:true,queryModel:"local",displayField:"appareData",valueField:"backData",id:"editDefaultHeight"},{fieldLabel:"工具图片",xtype:"filefield",id:"editTransFormImage",name:"editTransFormImage",buttonText:"选择图片"},{fieldLabel:"是否滚动",xtype:"radiogroup",id:"editScroll",name:"editScroll",vertical:true,items:[{boxLabel:"是",name:"srcollGroup",id:"srcollGroup1",inputValue:"1",checked:true},{boxLabel:"否",name:"srcollGroup",id:"srcollGroup2",inputValue:"2"}]}],buttons:[{text:"修改",handler:function(){var x=Ext.getCmp("editName").getValue();if(x==null||x==""){Ext.Msg.alert("提示","工具名不能为空");return}var u=Ext.getCmp("editCategory").getValue();if(u==null||u==""){Ext.Msg.alert("提示","工具类别不能为空");return}var v=Ext.getCmp("editDefaultHeight").getValue();if(v==null||v==""){Ext.Msg.alert("提示","默认高度不能为空");return}var y=Ext.getCmp("editScroll").getValue();if(y==null||y==""){Ext.Msg.alert("提示","是否自动滚动不能为空");return}var w=Ext.getCmp("editTransFormImage").getValue();if(w==null||w==""){Ext.Msg.alert("提示","图片不能为空");return}var t=Ext.getCmp("editDesc").getValue();if(t==null||t==""){Ext.Msg.alert("提示","描述不能为空");return}var z=w.lastIndexOf(".");var s=w.substring(z+1).toLowerCase();if(s!="png"&&s!="jpg"&&s!="jpeg"&&s!="gif"&&s!="bmp"){Ext.Msg.alert("提示","只能上传图片");return}Ext.getCmp("editFormPanel").getForm().submit({url:eastcom.baseURL+"/portal/editPortalFunction",method:"POST",success:function(B,C){if(result.success=="true"){Ext.Msg.show({title:"成功",msg:result.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});for(var A=0;A<p.length;A++){a.remove(p[A])}}else{Ext.Msg.show({title:"失败",msg:result.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}a.load();editWin.hide()},failure:function(A,B){Ext.Msg.alert("提示","修改失败");editWin.hide()}})}},{text:"取消",handler:function(){editWin.hide()}}]});Ext.onReady(function(){Ext.create("Ext.Viewport",{layout:"border",padding:5,items:[e,n]})})})();