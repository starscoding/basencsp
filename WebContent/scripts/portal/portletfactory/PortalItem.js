Ext.define("Ext.portletfactory.PortalItem",{extend:"Ext.app.Portlet",alias:"widget.portalitem",currentPortalId:"",height:null,refreshTime:0,columnNumber:null,positionSeq:null,reload:null,showTools:true,isFirstLoad:true,freshData:function(){var a=this;if(a.refreshTime!=0){a.reload();setTimeout(function(){a.freshData()},a.refreshTime*60*1000)}},getTools:function(){var b=this;var c=Ext.create("Ext.Action",{iconCls:"icon-refresh",text:BUTTON_REFRESH,handler:function(e,d){b.reload()}});var a=Ext.create("Ext.menu.Menu",{items:[{iconCls:"icon-question",text:LABEL_HEIGHT,handler:function(){return false},menu:{items:['<b class="menu-title">'+LABEL_HEIGHT+"</b>",{text:LABEL_LOW,checked:b.height==HEIGHT_MIN,group:"height"+b.id,handler:function(){if(b.height!=HEIGHT_MIN){b.height=HEIGHT_MIN;b.updateHeightAndRefreshTime();b.doLayout()}}},{text:LABEL_MID,checked:b.height==HEIGHT_MID,group:"height"+b.id,handler:function(){if(b.height!=HEIGHT_MID){b.height=HEIGHT_MID;b.updateHeightAndRefreshTime();b.doLayout()}}},{text:LABEL_HIGH,checked:b.height==HEIGHT_MAX,group:"height"+b.id,handler:function(){if(b.height!=HEIGHT_MAX){b.height=HEIGHT_MAX;b.updateHeightAndRefreshTime();b.doLayout()}}}]}},{iconCls:"set-scope",text:PORT_GADGETS_REFRESH_INTERVAL,handler:function(){return false},menu:{items:['<b class="menu-title">'+TIME+"</b>",{text:PORT_GADGETS_REFRESH_MANUAL,checked:b.refreshTime==0,group:"refreshTime"+b.id,handler:function(){if(b.refreshTime!=0){b.refreshTime=0;b.updateHeightAndRefreshTime()}}},{text:"1 "+MINUTES,checked:b.refreshTime==1,group:"refreshTime"+b.id,handler:function(){if(b.refreshTime!=1){b.refreshTime=1;b.updateHeightAndRefreshTime()}}},{text:"5 "+MINUTES,checked:b.refreshTime==5,group:"refreshTime"+b.id,handler:function(){if(b.refreshTime!=5){b.refreshTime=5;b.updateHeightAndRefreshTime()}}},{text:"10 "+MINUTES,checked:b.refreshTime==10,group:"refreshTime"+b.id,handler:function(){if(b.refreshTime!=10){b.refreshTime=10;b.updateHeightAndRefreshTime()}}},{text:"30 "+MINUTES,checked:b.refreshTime==30,group:"refreshTime"+b.id,handler:function(){if(b.refreshTime!=30){b.refreshTime=30;b.updateHeightAndRefreshTime()}}}]}},c]});return[{xtype:"tool",type:"gear",handler:function(h,g,f,d){h.stopEvent();a.showAt(h.getXY());return false}}]},updateHeightAndRefreshTime:function(){var a=this;a.getEl().mask(MSG_DATA_SAVING);Ext.Ajax.request({url:eastcom.baseURL+"/portal/updateHeightAndRefreshTime",method:"POST",params:{id:a.id,height:a.height,refreshTime:a.refreshTime},success:function(c,d){var b=Ext.JSON.decode(c.responseText);if(b.success=="true"){setTimeout(function(){a.freshData()},a.refreshTime*60*1000);a.unmask()}else{Ext.Msg.show({title:MSG_FAILURE,msg:b.msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});Ext.getBody().mask()}},failure:function(b,c){Ext.Msg.show({title:MSG_ERROR,msg:MSG_ERROR_PROMPT,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});Ext.getBody().mask()}})},items:[],listeners:{close:function(b){var a=Ext.getCmp(b.currentPortalId);a.removeIds.push(b.id);Ext.getCmp("col-"+b.currentPortalId+b.columnNumber).totalHeight-=b.height;Ext.getCmp("tabGroup").removeById(b.id);a.doSave()},afterlayout:function(a){if(a.isFirstLoad){a.reload();a.isFirstLoad=false}}},initComponent:function(){var a=this;if(a.reload){if(a.showTools){a.tools=a.getTools()}else{a.tbar=["->",{text:BUTTON_REFRESH,iconCls:"icon-refresh",handler:function(){a.reload()}}]}if(a.refreshTime!=0){setTimeout(function(){try{a.freshData()}catch(b){}finally{}},a.refreshTime*60*1000)}a.callParent()}else{Ext.Msg.alert("请提供reload方法!")}}});