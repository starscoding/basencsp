var UserInfoWin=function(e){var h=this;var j=function(){var l=i();e.closable=true;e.content=$(l);e.height=250;e.width=300};var i=function(){var l=eastcom.getUserInfo();var m='<div class="rfgcon" style="height:100%">';m+='<table class="rfgtab1" style="border-width:0px;" cellpadding="0" cellspacing="0" width="100%" height="100%">';m+="    <tr>";m+='        <td class="rfgtd1">'+USERNAME+"</td>";m+='        <td class="rfgtd2"><a style="float:left;">'+l.userName+'</a><button class="jumpButton buttonWidth windowCommonBtnCls1 windowCommonBtnCls2" name="editInfo">'+UE_EDIT_INFO+"</button></td>";m+="    </tr><tr>";m+='        <td class="rfgtd1">'+PASSWORD+"</td>";m+='        <td class="rfgtd2"><a style="float:left;">******</a><button class="jumpButton buttonWidth windowCommonBtnCls1 windowCommonBtnCls2" name="editPass">'+UE_EDIT_PWD+"</button></td>";m+="    </tr><tr>";m+='        <td class="rfgtd1">'+FULLNAME+"</td>";m+='        <td class="rfgtd2">'+l.fullName+"&nbsp;</td>";m+="    </tr><tr>";m+='        <td class="rfgtd1">'+MOBILE+"</td>";m+='        <td class="rfgtd2" name="info_mobile">'+l.mobileNo+"&nbsp;</td>";m+="    </tr><tr>";m+='        <td class="rfgtd1">'+TEL_NO+"</td>";m+='        <td class="rfgtd2" name="info_tel">'+(l.fixedNo!="null"?l.fixedNo:"")+"&nbsp;</td>";m+="    </tr><tr>";m+='        <td class="rfgtd1">'+EMAIL+"</td>";m+='        <td class="rfgtd2" name="info_email">'+(l.email!="null"?l.email:"")+"&nbsp;</td>";m+="    </tr>";m+="</table>";m+="</div>";return m};var c=function(){var l=eastcom.getUserInfo();var m="";m+='<form class="userInfoBaseForm" name="basicInfoForm">';m+='<p class="infoLine"><label class="infoLabel">'+TEL_NO+'：</label><input class="infoInput" name="tel" value="'+l.fixedNo+'"/><a class="errorIcon" name="fixNoTip"></a></p>';m+='<p class="infoLine"><label class="infoLabel"></label><a class="prompt">'+UE_INFO_NOTICE1+"</a></p>";m+='<p class="infoLine"><label class="infoLabel">'+MOBILE+'：</label><input class="infoInput" name="mobile" value="'+l.mobileNo+'"/><a class="errorIcon" name="mobileTip"></a></p>';m+='<p class="infoLine"><label class="infoLabel"></label><a class="prompt">'+UE_INFO_NOTICE2+"</a></p>";m+='<p class="infoLine"><label class="infoLabel">'+EMAIL+'：</label><input class="infoInput" name="email" value="'+l.email+'"/><a class="errorIcon" name="emailTip"></a></p>';m+='<p class="infoLine"><label class="infoLabel"></label><a class="prompt">'+UE_INFO_NOTICE3+"</a></p>";m+='<p  class="infoLine" style="display:block; text-align:center">';m+='<button name="submitUserBasicInfo"  class="buttonWidth windowCommonBtnCls1 windowCommonBtnCls2" type="button">'+BUTTON_OK+'</button><button name="renturnUserInfo"  class="buttonWidth windowCommonBtnCls1 windowCommonBtnCls2" type="button">'+BUTTON_CANCEL+"</button>";m+="</p>";m+="</form>";return m};var d=function(){return h.winId+"-contentContainer"};var k=function(m,o){var l=d();var n=null;switch(m){case 1:n=$("#"+l+" [name=fixNoTip]");break;case 2:n=$("#"+l+" [name=mobileTip]");break;case 3:n=$("#"+l+" [name=emailTip]");break}if(n&&n.length){if(o&&o.length){n.attr("title",o);n.show()}else{n.hide()}}};var g=function(p){var m=d();switch(p){case 1:var l=h.getBody();var s=$("#"+m+" button[name=editInfo]");var r=$("#"+m+" button[name=editPass]");s.click(function(){var t=$(c());l.append(t);t.slideDown(300,function(){g(2)})});r.click(function(){if(h.editPassForm){h.editPassForm.slideDown(300,function(){})}else{var w=new UserPasswordWin();var u=w.getBody();u.css({position:"absolute",top:0,left:0,height:"100%",width:"100%"});w.close(function(){});l.append(u);var t=w.getContainerId();var v=$('<button class="buttonWidth windowCommonBtnCls1 windowCommonBtnCls2" type="button" name="renturnUserInfo">'+BUTTON_CANCEL+"</button>");v.click(function(){u.slideUp(300,function(){u.hide()})});$("#"+t+" [name=btnsLine]").append(v);w.initEvents();u.slideDown(300,function(){});h.editPassForm=u}});break;case 2:var o=$("#"+m+" button[name=renturnUserInfo]");var q=$("#"+m+" button[name=submitUserBasicInfo]");o.click(function(){var t=$("#"+m+" :[name=basicInfoForm]");t.slideUp(300,function(){t.remove()})});q.click(function(){a(m)});var n=$("#"+m+" .infoInput");n.focus(function(){var t=$(this);t.removeClass();t.addClass("infoInput");t.addClass("focusInput")});n.blur(function(){b($(this))});n.change(function(){b($(this))});n.keyup(function(){b($(this))});break}};var a=function(l){var m=f(l);if(m){jQuery.ajax({type:"POST",async:false,dataType:"json",data:m,url:Eastcom.baseURL+"/sysmng/security/updateBasicInfo",success:function(n){alert(n.msg);if(n.success=="true"){Eastcom.userInfo.fixedNo=m.tel;Eastcom.userInfo.mobileNo=m.mobile;Eastcom.userInfo.email=m.email;var q=$("#"+l+" [name=info_tel]");var p=$("#"+l+" [name=info_mobile]");var r=$("#"+l+" [name=info_email]");q.empty();p.empty();r.empty();q.append(m.tel);p.append(m.mobile);r.append(m.email);var o=$("#"+l+" button[name=renturnUserInfo]");o.click()}}})}};var f=function(m){var l=true;var n=$("#"+m+" .infoInput");$.each(n,function(p,o){if(b($(o))==false){l=false}});return l?{mobile:$("#"+m+" :input[name=mobile]").attr("value"),tel:$("#"+m+" :input[name=tel]").attr("value"),email:$("#"+m+" :input[name=email]").attr("value")}:false};var b=function(l){var n=l.attr("name");var p=l.attr("value");l.removeClass();l.addClass("infoInput");var m=true;if(p!=null&&p.length>0){var o=null;switch(n){case"tel":o=new RegExp("^\\(?\\d{3,4}[-\\)]?\\d{7,8}$");break;case"mobile":o=new RegExp("^0?\\d{11}$");break;case"email":o=new RegExp("^[a-zA-Z0-9_+.-]+@([a-zA-Z0-9-]+.)+[a-zA-Z0-9]{2,4}$");break}if(o){m=o.test(p)}if(m){switch(n){case"tel":k(1,null);break;case"mobile":k(2,null);break;case"email":k(3,null);break}}else{l.addClass("errorInput");switch(n){case"tel":k(1,UD_INF_STYLE_MSG);break;case"mobile":k(2,UD_INF_STYLE_MSG);break;case"email":k(3,UD_INF_STYLE_MSG);break}}}return m};j();CommonWindow.call(h,e);g(1)};